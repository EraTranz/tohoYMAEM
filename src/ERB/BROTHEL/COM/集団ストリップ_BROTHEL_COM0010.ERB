;=============================================================================
;ストリップの処理
;=============================================================================
;-------------------------------------------------
;売春コマンド実行可能判定処理
;-------------------------------------------------
@PROSTITUTE_ABLE_COM10, ARG
;キャラが売春可能であるかの共通判定処理を満たしている
SIF BROTHEL_COM_ABLE_COMMON(ARG) == 0
	RETURN 0
RETURN 1

;=============================================================================
;選択可能処理
;=============================================================================
@JUDGE_PROSTITUTE_COM11, ARG
RETURN 1
@JUDGE_PROSTITUTE_COM12, ARG
RETURN 1
@JUDGE_PROSTITUTE_COM13, ARG
;オトコは当然アウト
SIF TALENT:ARG:オトコ
	RETURN 0
RETURN 1
@JUDGE_PROSTITUTE_COM14, ARG
;娼館に淫具が無いとダメ
SIF (FLAG:3000 & 2) == 0
	RETURN 0
RETURN 1
@JUDGE_PROSTITUTE_COM15, ARG
;マイクがないとダメある程度の歌唱力はいる
SIF ITEM:マイク == 0 || ABL:歌唱技能 < 3
	RETURN 0
RETURN 1
@JUDGE_PROSTITUTE_COM16, ARG
;娼館に淫具が無いとダメ
SIF (FLAG:3000 & 2) == 0 || ITEM:マイク == 0 || ABL:歌唱技能 < 3
	RETURN 0
RETURN 1
;-------------------------------------------------
;売春コマンドの分岐処理
;-------------------------------------------------
@PROSTITUTE_COM10, ARG
#LOCALSIZE 1
CALL CHOOSE_PROSTITUTE_COM, ARG, 1
SELECTCOM = RESULT

SIF TALENT:MASTER:998
	PRINTFORML SELECTCOM = {SELECTCOM}

;顧客の設定
CALL PROSTITUTE_SET_NEW_CUSTOMER_TYPE1, ARG

;欲望をチェックする。欲望が相手の欲望を上回るかどうか。成功なら欲望レベルの２倍、失敗なら１倍入ります。
;ストリップでは、相手の欲望の最大値が低めで、満足させやすいです。
LOCAL = RAND:4
IF LOCAL <= ABL:ARG:欲望
	TFLAG:408 = LOCAL + ABL:ARG:欲望 * 2
ELSE
	TFLAG:408 = LOCAL + ABL:ARG:欲望
ENDIF

;相手からの行動は無いため、露出癖、奉仕精神がそのまま得点に入ります。
;ただし5でストップします。
TFLAG:408 += MIN(ABL:ARG:奉仕精神, 5) + MIN(ABL:ARG:露出癖, 5)
TFLAG:403 = 0

;従順がLV2以上ないと、著しく微妙になります
SIF ABL:ARG:従順 < 2
	TFLAG:408 /= 2

;………………………………………………
;選択された売春コマンドを実行
;………………………………………………
;ここからは、プレイ内容の領分に入ってきますので、分岐後に任せます。
;ここまでの満足度は合計最大60点。
;プレイ内容の方で20点。
;結果、最大80ポイント、平均40程度の満足度になります。ランダムが40を占めるので、割と安定しません。
;ただし、素質的な要因がある場合は80ポイントを突破をしても構いません。割とアバウト。
TRYCCALLFORM PROSTITUTE_COM{SELECTCOM}, ARG
	SIF RESULT == 1
		RETURN 1
CATCH
ENDCATCH
RETURN 0

;=============================================================================
;ストリップ(普通の)の処理
;=============================================================================
;2つのパターンのうち、効果が高いものを実行します
;-------------------------------------------------
;売春コマンド処理
;-------------------------------------------------
@PROSTITUTE_COM11, ARG
#LOCALSIZE 2
VARSET LOCAL, 0

PRINTL ストリップ -ストリップ-

;欲望、技巧、奉仕精神、露出癖をみる
TFLAG:408 += ABL:ARG:欲望 + ABL:ARG:技巧 + ABL:ARG:奉仕精神 + ABL:ARG:露出癖

;献身的
SIF TALENT:ARG:献身的
	TIMES TFLAG:408, 1.5

DOWNBASE:ARG:0 += 5
DOWNBASE:ARG:1 += 10

CALL PROSTITUTE_NEW_CUSTOMER_SATISFACTION, ARG

TCVAR:ARG:露出快楽経験 = TFLAG:401

;ビデオ撮影中
SIF TFLAG:403 & 16
	TCVAR:ARG:被写経験 = ( RAND:10 < 3 ) ? 2 # 1

TFLAG:405 = 1
RETURN 1

;-------------------------------------------------
;売春コマンドの地の文
;-------------------------------------------------
@SYSTXT_MESSAGE_PROSTITUTION_COM11


;=============================================================================
;ストリップ(オナニーショー)の処理
;=============================================================================
;-------------------------------------------------
;売春コマンド処理
;-------------------------------------------------
;設備LV2かつ、Ｖ感覚LV3以上かＡ感覚LV3以上であれば、バイブを使いながらの接待となる。
;バイブを使った場合、満足度が1つなら+1、両方使ったなら+3される。
@PROSTITUTE_COM12, ARG
VARSET LOCAL, 0
DOWNBASE:ARG:0 += 5
DOWNBASE:ARG:1 += 10

PRINTL ストリップ -オナニーショー-

IF ABL:ARG:Ｖ感覚 > ABL:ARG:Ａ感覚 || RAND:3 == 0
	TFLAG:99 = 0
	LOCAL = ABL:ARG:Ｖ感覚
ELSEIF ABL:ARG:Ｖ感覚 < ABL:ARG:Ａ感覚 || RAND:2 == 0 || TALENT:ARG:オトコ
	TFLAG:99 = 1
	LOCAL = ABL:ARG:Ａ感覚
ELSE
	TFLAG:99 = 2
	LOCAL = ABL:ARG:Ｖ感覚 + ABL:ARG:Ａ感覚
ENDIF

;欲望、技巧、露出癖、自慰中毒をみる
TFLAG:408 += LOCAL + ABL:ARG:欲望 + ABL:ARG:技巧 + ABL:ARG:露出癖 + ABL:ARG:自慰中毒

;献身的
SIF TALENT:ARG:献身的
	TIMES TFLAG:408, 1.5

CALL PROSTITUTE_NEW_CUSTOMER_SATISFACTION, ARG
SELECTCASE TFLAG:99
	CASE 0
		TCVAR:ARG:Ｖ経験 = 1
	CASE 1
		TCVAR:ARG:Ａ経験 = 1
		TCVAR:ARG:Ａ快楽経験 = 1
	CASE 2
		TCVAR:ARG:Ｖ経験 = 1
		TCVAR:ARG:Ａ経験 = 1
		TCVAR:ARG:絶頂経験 += 1
		TCVAR:ARG:Ａ快楽経験 = 1
ENDSELECT
TCVAR:ARG:絶頂経験 += 1
TCVAR:ARG:自慰経験 = 1
TCVAR:ARG:露出快楽経験 = TFLAG:401

;ビデオ撮影中
SIF TFLAG:403 & 16
	TCVAR:ARG:被写経験 = ( RAND:10 < 3 ) ? 2 # 1

TFLAG:405 = 1
RETURN 1

;-------------------------------------------------
;売春コマンドの地の文
;-------------------------------------------------
@SYSTXT_MESSAGE_PROSTITUTION_COM12

;=============================================================================
;ストリップ(秘貝開帳)の処理
;=============================================================================
;-------------------------------------------------
;売春コマンド処理
;-------------------------------------------------
@PROSTITUTE_COM13, ARG
VARSET LOCAL, 0
DOWNBASE:ARG:0 += 5
DOWNBASE:ARG:1 += 10

PRINTL ストリップ -秘貝開帳-

;欲望、技巧、奉仕精神、露出癖をみる
TFLAG:408 += ABL:ARG:欲望 + ABL:ARG:技巧 + ABL:ARG:奉仕精神 + ABL:ARG:露出癖

;献身的
SIF TALENT:ARG:献身的
	TIMES TFLAG:408, 1.5

CALL PROSTITUTE_NEW_CUSTOMER_SATISFACTION, ARG

TCVAR:ARG:露出快楽経験 = TFLAG:401

;ビデオ撮影中
SIF TFLAG:403 & 16
	TCVAR:ARG:被写経験 = ( RAND:10 < 3 ) ? 2 # 1

TFLAG:405 = 1
RETURN 1

;-------------------------------------------------
;売春コマンドの地の文
;-------------------------------------------------
@SYSTXT_MESSAGE_PROSTITUTION_COM13


;=============================================================================
;ストリップ(バイブハメストリップ)の処理
;=============================================================================
;相手の性器を責める。ちぎる。なげる。
;-------------------------------------------------
;売春コマンド処理
;-------------------------------------------------
@PROSTITUTE_COM14, ARG
VARSET LOCAL, 0
DOWNBASE:ARG:0 += 10
DOWNBASE:ARG:1 += 15

PRINTL ストリップ -ストリップ with バイブ-

IF ABL:ARG:Ｖ感覚 > ABL:ARG:Ａ感覚 || RAND:3 == 0
	TFLAG:99 = 0
	LOCAL = ABL:ARG:Ｖ感覚
ELSEIF ABL:ARG:Ｖ感覚 < ABL:ARG:Ａ感覚 || RAND:2 == 0
	TFLAG:99 = 1
	LOCAL = ABL:ARG:Ａ感覚
ELSE
	TFLAG:99 = 2
	LOCAL = ABL:ARG:Ｖ感覚 + ABL:ARG:Ａ感覚
ENDIF

;V/A、欲望、技巧、露出癖をみる
TFLAG:408 += LOCAL + ABL:ARG:欲望 + ABL:ARG:技巧 + ABL:ARG:露出癖

;献身的
SIF TALENT:ARG:献身的
	TIMES TFLAG:408, 1.5

CALL PROSTITUTE_NEW_CUSTOMER_SATISFACTION, ARG

TCVAR:ARG:露出快楽経験 = TFLAG:401

;ビデオ撮影中
SIF TFLAG:403 & 16
	TCVAR:ARG:被写経験 = ( RAND:10 < 3 ) ? 2 # 1

TFLAG:405 = 1
RETURN 1

;-------------------------------------------------
;売春コマンドの地の文
;-------------------------------------------------
@SYSTXT_MESSAGE_PROSTITUTION_COM14


;=============================================================================
;ストリップ(歌謡ストリップ)の処理
;=============================================================================
;相手を責める。ちぎる。なげる。攻撃する。
;2つのパターンのうち、効果が高いものを実行します
;-------------------------------------------------
;売春コマンド処理
;-------------------------------------------------
@PROSTITUTE_COM15, ARG
#LOCALSIZE 2
VARSET LOCAL, 0

PRINTL ストリップ -歌謡ストリップショー-

;欲望、技巧、露出癖をみる
TFLAG:408 += ABL:ARG:欲望 + ABL:ARG:技巧 + ABL:ARG:露出癖

LOCAL = EXP:ARG:歌唱経験 / 2 * (ABL:ARG:歌唱技能 - 2)
;成功
IF TFLAG:400 < LOCAL && RAND:100
	TFLAG:99 = 0
;失敗,1/100の確率で
ELSE
	TFLAG:99 = 1
ENDIF

DOWNBASE:ARG:0 += 5
DOWNBASE:ARG:1 += 15

CALL PROSTITUTE_NEW_CUSTOMER_SATISFACTION, ARG

TCVAR:ARG:露出快楽経験 = TFLAG:401
TCVAR:ARG:歌唱経験 = 2 * ABL:ARG:歌唱技能

;ビデオ撮影中
SIF TFLAG:403 & 16
	TCVAR:ARG:被写経験 = ( RAND:10 < 3 ) ? 2 # 1
TFLAG:405 = 2
RETURN 1

;-------------------------------------------------
;売春コマンドの地の文
;-------------------------------------------------
@SYSTXT_MESSAGE_PROSTITUTION_COM15


;=============================================================================
;ストリップ(バイブはめ歌謡ストリップ)の処理
;=============================================================================
;縛った状態を眺めるという紳士プレイ。
;-------------------------------------------------
;売春コマンド処理
;-------------------------------------------------
@PROSTITUTE_COM16, ARG
VARSET LOCAL, 0
DOWNBASE:ARG:0 += 15
DOWNBASE:ARG:1 += 20

PRINTL ストリップ -歌謡ストリップショー with バイブ-

;欲望、技巧、露出癖をみる
TFLAG:408 += ABL:ARG:欲望 + ABL:ARG:技巧 + ABL:ARG:露出癖

LOCAL = EXP:ARG:歌唱経験 / 2 * (ABL:ARG:歌唱技能 - 2)
;ここは失敗を見るためのショーなので成功したら面白くない
;成功
IF TFLAG:400 < LOCAL
	TFLAG:99 = 0
;失敗
ELSE
	TFLAG:99 = 1
ENDIF

CALL PROSTITUTE_NEW_CUSTOMER_SATISFACTION, ARG

TCVAR:ARG:露出快楽経験 = TFLAG:401

;ビデオ撮影中
SIF TFLAG:403 & 16
	TCVAR:ARG:被写経験 = ( RAND:10 < 3 ) ? 2 # 1
TFLAG:405 = 2
RETURN 1

;-------------------------------------------------
;売春コマンドの地の文
;-------------------------------------------------
@SYSTXT_MESSAGE_PROSTITUTION_COM16

