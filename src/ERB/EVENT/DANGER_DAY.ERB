;月経進行
@EVENT_DANGERDAY
;CFLAG:3669
;月経周期
;0～4	生理期
;5～8	安全日
;9～12	危険日
;13		排卵日
;14～18	危険日
;19～27	安全日
REPEAT CHARANUM
	;オトコではない
	IF COM_ABLE_CHECK_FEMALE(COUNT) && !TALENT:COUNT:幼児 && !TALENT:COUNT:死亡
		SELECTCASE CFLAG:COUNT:3669
			CASE 0, 5, 14, 19
				;20％の確率で短縮（生理期、生理期以降、排卵日以降、危険日以降）
				SIF !RAND:5
					CFLAG:COUNT:3669 ++
		ENDSELECT
		CFLAG:COUNT:3669 ++
		;10％の確率で延長
		SIF RAND:(10 + SPECIAL_CYCLE_CHECK(COUNT))
			CFLAG:COUNT:3669 %= 28
		;月経の状態を把握
		CALL EVENT_DANGERDAY_CHECK, COUNT
	ELSE
		TALENT:COUNT:危険日 = 0
		TALENT:COUNT:生理 = 0
		TALENT:COUNT:排卵 = 0
		CFLAG:COUNT:3669 = 0
	ENDIF
REND

@EVENT_DANGERDAY_CHECK, ARG
;TALENT:危険日	危険日
;TALENT:生理	生理
;TALENT:排卵	排卵
SELECTCASE CFLAG:ARG:3669
CASE 0 TO 4
	TALENT:ARG:危険日 = 0
	TALENT:ARG:生理 = 1
	TALENT:ARG:排卵 = 0
CASE 5 TO 8
	TALENT:ARG:危険日 = 0
	TALENT:ARG:生理 = 0
	TALENT:ARG:排卵 = 0
CASE 9 TO 12
	TALENT:ARG:危険日 = 1
	TALENT:ARG:生理 = 0
	TALENT:ARG:排卵 = 0
CASE 13
	TALENT:ARG:危険日 = 1
	TALENT:ARG:生理 = 0
	TALENT:ARG:排卵 = 1
CASE 14 TO 18
	TALENT:ARG:危険日 = 1
	TALENT:ARG:生理 = 0
	TALENT:ARG:排卵 = 0
CASE IS >= 19
	TALENT:ARG:危険日 = 0
	TALENT:ARG:生理 = 0
	TALENT:ARG:排卵 = 0
ENDSELECT

;初期月経周期の設定
@EVENT_ADD_CHARA_MENSTRUATION, ARG
;オトコではない
IF COM_ABLE_CHECK_FEMALE(ARG) && !TALENT:ARG:幼児 && !TALENT:ARG:死亡
	CFLAG:ARG:3669 = RAND:(28 + SPECIAL_CYCLE_CHECK(ARG))
	CALL EVENT_DANGERDAY_CHECK, ARG
ELSE
	TALENT:ARG:危険日 = 0
	TALENT:ARG:生理 = 0
	TALENT:ARG:排卵 = 0
	CFLAG:ARG:3669 = 0
ENDIF

@SPECIAL_CYCLE_CHECK, ARG
#FUNCTION
RETURNF TALENT:ARG:機械 + TALENT:ARG:霊体 + TALENT:ARG:人形 + TALENT:ARG:爆発物 + TALENT:ARG:神霊 + TALENT:ARG:半神 + (NO:ARG == 5001) + (NO:ARG == 5002)

@CYCLE_PRINT ,ARG
IF TALENT:ARG:幼児 || (CFLAG:ARG:9 & 8 && NO:ARG == 1010 && CFLAG:7828 < 2) || (CFLAG:ARG:9 & 8 && NO:ARG == 1011 && CFLAG:5828 < 2)
	IF DAY >= (CFLAG:ARG:誕生日 + 49) || (CFLAG:ARG:9 & 8 && NO:ARG == 1010 && DAY - CFLAG:ARG:7831 >= 15 && CFLAG:ARG:7830 == 1 && ABL:ARG:Ｖ感覚 >= 3 && CFLAG:ARG:7833 >= 13 && ABL:ARG:精液中毒 >= 1) || (CFLAG:ARG:9 & 8 && NO:ARG == 1011 && DAY - CFLAG:ARG:5820 >= 13 && CFLAG:ARG:5830 == 1 && ABL:ARG:Ｖ感覚 >= 5 && CFLAG:ARG:5833 >= 10 && ABL:ARG:精液中毒 >= 1)
		SETCOLOR COLOR("P-RED")
		PRINT 初潮日
	ELSE
		SETCOLOR 0x60EEEE
		PRINTFORM 初潮未經驗
	ENDIF
	IF TALENT:ARG:常時発情
		RESETCOLOR
		PRINT ＆
		SETCOLOR COLOR("PINK")
		PRINT ♥発情♥
	ENDIF
ELSEIF TALENT:ARG:妊娠
	SETCOLOR COLOR("PINK")
	PRINT ♥妊娠♥
	IF TALENT:ARG:常時発情
		RESETCOLOR
		PRINT ＆
		SETCOLOR COLOR("PINK")
		PRINT ♥発情♥
	ENDIF
ELSEIF TALENT:ARG:抱卵中
	SETCOLOR COLOR("PINK")
	PRINT ♥抱卵♥
	IF TALENT:ARG:常時発情
		RESETCOLOR
		PRINT ＆
		SETCOLOR COLOR("PINK")
		PRINT ♥発情♥
	ENDIF
ELSEIF TALENT:ARG:懐卵
	SETCOLOR COLOR("PINK")
	PRINT ♥懐卵♥
	IF TALENT:ARG:常時発情
		RESETCOLOR
		PRINT ＆
		SETCOLOR COLOR("PINK")
		PRINT ♥発情♥
	ENDIF
ELSEIF TALENT:ARG:排卵
	SETCOLOR 0xEE60EE
	PRINT 排卵
	IF TALENT:ARG:常時発情
		RESETCOLOR
		PRINT ＆
		SETCOLOR COLOR("PINK")
		PRINT ♥発情♥
	ELSE
		PRINT 日
	ENDIF
ELSEIF TALENT:ARG:危険日
	SETCOLOR COLOR("PINK")
	IF TALENT:ARG:常時発情 || TALENT:ARG:発情可
		PRINT ♥発情中♥
	ELSE
		PRINT ♥危険日♥
	ENDIF
ELSEIF TALENT:ARG:生理
	SETCOLOR COLOR("P-RED")
	PRINT 生理
	IF TALENT:ARG:常時発情
		RESETCOLOR
		PRINT ＆
		SETCOLOR COLOR("PINK")
		PRINT ♥発情♥
	ELSE
		PRINT 期
	ENDIF
ELSE
	IF TALENT:ARG:常時発情
		SETCOLOR COLOR("PINK")
		PRINT ♥発情中♥
	ELSE
		SETCOLOR 0x60EEEE
		PRINTFORM 安全日
	ENDIF
ENDIF
RESETCOLOR