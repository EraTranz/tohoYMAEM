;=============================================================================
;強制開口器
;=============================================================================
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE229
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:229 > 0
	RETURN 0
;ボールギャグ装着中、触手口辱中はダメ
SIF TEQUIP:口装着器具 && TEQUIP:口装着器具 != 3
	RETURN 0
;解除はいつでも可能
SIF TEQUIP:口装着器具 == 3
	RETURN 1
;アイテムを持っていないとダメ
SIF ITEM:強制開口器 == 0
	RETURN 0
;助手調教の場合、技巧4以上じゃないと使えない
SIF ASSIPLAY && ABL:PLAYER:技巧 < 4
	RETURN 0
;小柄体型なら従順が3以上かつマゾっ気が2以上じゃないと実行できない
IF TALENT:小柄体型
	SIF ABL:従順 < 3 || ABL:マゾっ気 < 2
		RETURN 0
ENDIF
;調教対象が小人体型の場合は主人が禁断の知識持ち、かつ従順が3以上かつマゾっ気が2以上じゃないとダメ
SIF TALENT:小人体型 && (TALENT:MASTER:禁断の知識 == 0 || (ABL:従順 < 4 || ABL:マゾっ気 < 3))
	RETURN 0
;裸エプロン中はダメ
SIF TEQUIP:コスチュームプレイ == 1
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 229) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM229
PRINTL 強制開口器

;戦闘判定
CALL COM_TRY_BATTLE, 229
;実行できない
SIF RESULT == 1
	RETURN 1

TSTR:0 = 強制開口器
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

;-------------------------------------------------
;ソースの計算
;-------------------------------------------------
;緊縛経験が高いと消費減少
IF EXP:緊縛経験 < EXPLV:3
	DOWNBASE:0 += 100
	DOWNBASE:1 += 180
ELSEIF EXP:緊縛経験 < EXPLV:4
	DOWNBASE:0 += 90
	DOWNBASE:1 += 130
ELSE
	DOWNBASE:0 += 80
	DOWNBASE:1 += 80
ENDIF

SOURCE:恭順追加 = 300
SOURCE:痛み = 300
SOURCE:屈従 = 400
SOURCE:支配 = 200
SOURCE:逸脱 = 200

LOCAL:1 = 0
LOCAL:2 = 0
LOCAL:3 = 300
LOCAL:4 = 200
LOCAL:5 = 300

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	LOCAL:1 = 50
ELSEIF ABL:マゾっ気 == 1
	LOCAL:1 = 150
	LOCAL:2 = 100
ELSEIF ABL:マゾっ気 == 2
	LOCAL:1 = 300
	LOCAL:2 = 150
ELSEIF ABL:マゾっ気 == 3
	LOCAL:1 = 450
	LOCAL:2 = 200
ELSEIF ABL:マゾっ気 == 4
	LOCAL:1 = 600
	LOCAL:2 = 250
ELSE
	LOCAL:1 = 800
	LOCAL:2 = 350
ENDIF

;;ABL:露出癖をみる
;IF ABL:露出癖 == 0
;	TIMES LOCAL:1 , 0.70
;ELSEIF ABL:露出癖 == 1
;	TIMES LOCAL:1 , 0.90
;ELSEIF ABL:露出癖 == 2
;	TIMES LOCAL:1 , 1.00
;ELSEIF ABL:露出癖 == 3
;	TIMES LOCAL:1 , 1.10
;ELSEIF ABL:露出癖 == 4
;	TIMES LOCAL:1 , 1.30
;ELSE
;	TIMES LOCAL:1 , 1.50
;ENDIF

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL:1 , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL:1 , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL:1 , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL:1 , 1.10
ELSE
	TIMES LOCAL:1 , 1.20
ENDIF

;TALENT:臆病をみる
IF TALENT:臆病
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:4 , 2.00
ENDIF
;TALENT:反抗的をみる
IF TALENT:反抗的
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:2 , 0.80
	TIMES LOCAL:3 , 1.50
ENDIF
;TALENT:プライド高いをみる
IF TALENT:プライド高い
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:2 , 0.80
	TIMES LOCAL:3 , 1.50
ENDIF
;TALENT:感情乏しいをみる
IF TALENT:感情乏しい
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:3 , 0.80
	TIMES LOCAL:4 , 0.80
ENDIF
;TALENT:抑圧をみる
IF TALENT:抑圧
	TIMES LOCAL:1 , 0.30
	TIMES LOCAL:2 , 0.50
	TIMES LOCAL:4 , 0.60
ENDIF
;TALENT:解放をみる
IF TALENT:解放
	TIMES LOCAL:1 , 1.20
	TIMES LOCAL:2 , 1.20
	TIMES LOCAL:3 , 0.60
	TIMES LOCAL:4 , 0.80
ENDIF
;TALENT:恥じらいをみる
IF TALENT:恥じらい
	TIMES LOCAL:1 , 1.20
;TALENT:恥薄いをみる
ELSEIF TALENT:恥薄い
	TIMES LOCAL:1 , 0.90
	TIMES LOCAL:2 , 0.90
ENDIF
;TALENT:痛みに弱いをみる
IF TALENT:痛みに弱い
	TIMES LOCAL:5 , 2.00
;TALENT:痛みに強いをみる
ELSEIF TALENT:痛みに強い
	TIMES LOCAL:5 , 0.80
ENDIF
;TALENT:倒錯的をみる
IF TALENT:倒錯的
	TIMES LOCAL:1 , 2.00
	TIMES LOCAL:2 , 1.50
	TIMES LOCAL:3 , 0.40
	TIMES LOCAL:4 , 0.80
ENDIF
;TALENT:小人体型をみる
SIF TALENT:小人体型
	TIMES LOCAL:5 , 2.00
;TALENT:小柄体型をみる
SIF TALENT:小柄体型
	TIMES LOCAL:5 , 1.50
;TALENT:狂気をみる
IF TALENT:狂気
	TIMES LOCAL:1 , 0.70
	TIMES LOCAL:3 , 1.50
	TIMES LOCAL:4 , 0.10
ENDIF
;TALENT:精神崩壊をみる
IF TALENT:精神崩壊
	TIMES LOCAL:1 , 0.10
	TIMES LOCAL:4 , 0.10
ENDIF
;TALENT:ドＭをみる
IF TALENT:ドＭ
	TIMES LOCAL:1 , 1.50
	TIMES LOCAL:2 , 1.50
ENDIF

SOURCE:露出 += LOCAL:1
SOURCE:恭順追加 += LOCAL:1
SOURCE:痛み += LOCAL:5
SOURCE:屈従 += LOCAL:1
SOURCE:支配 += LOCAL:4
SOURCE:中毒充足 += LOCAL:2
SOURCE:逸脱 += (LOCAL:1 + LOCAL:3 * 2) / 3

TCVAR:緊縛経験 += 2
;ＳＭ教育経験フラグ
SIF ASSIPLAY
	TFLAG:55 = 2

;コマンド属性：道具(調教者)
SIF TEQUIP:触手調教 == 0
	TFLAG:98 = 1

;強制開口器の着脱
IF TEQUIP:口装着器具
	TEQUIP:口装着器具 = 0
ELSE
	TEQUIP:口装着器具 = 3
ENDIF
RETURN 1

;-------------------------------------------------
;強制開口器装備中
;-------------------------------------------------
@EQUIP_COM229
PRINTL ＜強制開口器装備中＞

;緊縛経験が高いと消費減少
IF EXP:緊縛経験 < EXPLV:3
	DOWNBASE:0 += 80
	DOWNBASE:1 += 140
ELSEIF EXP:緊縛経験 < EXPLV:4
	DOWNBASE:0 += 70
	DOWNBASE:1 += 100
ELSE
	DOWNBASE:0 += 60
	DOWNBASE:1 += 60
ENDIF

LOCAL = 0
LOCAL:1 = 0
LOCAL:2 = 300
LOCAL:3 = 200
LOCAL:4 = 300

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	LOCAL = 40
ELSEIF ABL:マゾっ気 == 1
	LOCAL = 120
	LOCAL:1 = 80
ELSEIF ABL:マゾっ気 == 2
	LOCAL = 250
	LOCAL:1 = 100
ELSEIF ABL:マゾっ気 == 3
	LOCAL = 450
	LOCAL:1 = 150
ELSEIF ABL:マゾっ気 == 4
	LOCAL = 600
	LOCAL:1 = 200
ELSE
	LOCAL = 750
	LOCAL:1 = 300
ENDIF

;;ABL:露出癖をみる
;IF ABL:露出癖 == 0
;	TIMES LOCAL , 0.70
;ELSEIF ABL:露出癖 == 1
;	TIMES LOCAL , 0.90
;ELSEIF ABL:露出癖 == 2
;	TIMES LOCAL , 1.00
;ELSEIF ABL:露出癖 == 3
;	TIMES LOCAL , 1.10
;ELSEIF ABL:露出癖 == 4
;	TIMES LOCAL , 1.30
;ELSE
;	TIMES LOCAL , 1.50
;ENDIF

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL , 1.10
ELSE
	TIMES LOCAL , 1.20
ENDIF

;TALENT:臆病をみる
IF TALENT:臆病
	TIMES LOCAL , 0.80
	TIMES LOCAL:3 , 2.00
ENDIF
;TALENT:反抗的をみる
IF TALENT:反抗的
	TIMES LOCAL , 0.80
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:2 , 1.50
ENDIF
;TALENT:プライド高いをみる
IF TALENT:プライド高い
	TIMES LOCAL , 0.80
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:2 , 1.50
ENDIF
;TALENT:感情乏しいをみる
IF TALENT:感情乏しい
	TIMES LOCAL , 0.80
	TIMES LOCAL:2 , 0.80
	TIMES LOCAL:3 , 0.80
ENDIF
;TALENT:抑圧をみる
IF TALENT:抑圧
	TIMES LOCAL , 0.30
	TIMES LOCAL:1 , 0.50
	TIMES LOCAL:3 , 0.60
ENDIF
;TALENT:解放をみる
IF TALENT:解放
	TIMES LOCAL , 1.20
	TIMES LOCAL:1 , 1.20
	TIMES LOCAL:2 , 0.60
	TIMES LOCAL:3 , 0.80
ENDIF
;TALENT:恥じらいをみる
IF TALENT:恥じらい
	TIMES LOCAL , 1.20
;TALENT:恥薄いをみる
ELSEIF TALENT:恥薄い
	TIMES LOCAL , 0.90
	TIMES LOCAL:1 , 0.90
ENDIF
;TALENT:痛みに弱いをみる
IF TALENT:痛みに弱い
	TIMES LOCAL:4 , 2.00
;TALENT:痛みに強いをみる
ELSEIF TALENT:痛みに強い
	TIMES LOCAL:4 , 0.80
ENDIF
;TALENT:倒錯的をみる
IF TALENT:倒錯的
	TIMES LOCAL , 2.00
	TIMES LOCAL:1 , 1.50
	TIMES LOCAL:2 , 0.40
	TIMES LOCAL:3 , 0.80
ENDIF
;TALENT:小人体型をみる
SIF TALENT:小人体型
	TIMES LOCAL:4 , 2.00
;TALENT:小柄体型をみる
SIF TALENT:小柄体型
	TIMES LOCAL:4 , 1.50
;TALENT:狂気をみる
IF TALENT:狂気
	TIMES LOCAL , 0.70
	TIMES LOCAL:2 , 1.50
	TIMES LOCAL:3 , 0.10
ENDIF
;TALENT:精神崩壊をみる
IF TALENT:精神崩壊
	TIMES LOCAL , 0.10
	TIMES LOCAL:3 , 0.10
ENDIF
;TALENT:ドＭをみる
IF TALENT:ドＭ
	TIMES LOCAL , 1.50
	TIMES LOCAL:1 , 1.50
ENDIF

SOURCE:露出 += LOCAL
SOURCE:恭順追加 += LOCAL
SOURCE:痛み += LOCAL:4
SOURCE:屈従 += LOCAL
SOURCE:支配 += LOCAL:3
SOURCE:中毒充足 += LOCAL:1
SOURCE:逸脱 += (LOCAL + LOCAL:2 * 2) / 3

IF TALENT:オトコ == 0 && TALENT:PLAYER:オトコ == 0
	TCVAR:レズ経験 += 1
ELSEIF TALENT:オトコ && TALENT:PLAYER:オトコ
	TCVAR:ＢＬ経験 += 1
ENDIF

TCVAR:緊縛経験 += 1
RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_229
PRINTFORM %CALLNAME:PLAYER%は、
IF TEQUIP:口装着器具
	PRINTFORML %CALLNAME:TARGET%から強制開口器を取ってやった
ELSE
	IF EQUIP:睡眠薬 || TFLAG:899 > 0
		PRINTFORML %CALLNAME:TARGET%に強制開口器を嵌めさせた
	ELSE
		;倒錯的で恐怖刻印が1以下で反発刻印がない場合
		IF TALENT:倒錯的 && MARK:恐怖刻印 < 2 && MARK:反発刻印 < 1
			PRINTFORML %CALLNAME:TARGET%に強制開口器を嵌めさせた。
			PRINTFORML %CALLNAME:TARGET%はむりあり開けられた口から、今にも快楽の叫び声を上げそうだ…
		;反抗的か抵抗を持ち陥落してない場合
		ELSEIF (TALENT:反抗的 || TALENT:抵抗) && TALENT:恋慕 == 0 && TALENT:服従 == 0 && TALENT:淫乱 == 0
			PRINTFORML 激しく嫌がる%CALLNAME:TARGET%に強引に強制開口器を嵌めさせた…
		;臆病持ちか恐怖刻印2以上で気丈と感情乏しいを持たず、陥落していない場合
		ELSEIF (TALENT:臆病 || MARK:恐怖刻印 >= 2) && TALENT:気丈 == 0 && TALENT:感情乏しい == 0 && TALENT:恋慕 == 0 && TALENT:服従 == 0 && TALENT:淫乱 == 0
			PRINTFORML 恐怖に怯える%CALLNAME:TARGET%に強制開口器を丁寧に嵌めてあげた…
		;プライド高いか神霊でなおかつ、屈服刻印と恥辱刻印が1以下で、陥落していない場合
		ELSEIF (TALENT:プライド高い || TALENT:神霊) && MARK:屈服刻印 < 2 && MARK:恥辱刻印 < 2 && TALENT:恋慕 == 0 && TALENT:服従 == 0 && TALENT:淫乱 == 0
			PRINTFORML %CALLNAME:TARGET%に強制開口器を嵌めさせた。
			PRINTFORML %CALLNAME:TARGET%は屈辱に震えながらも、そのプライドだけは折れてはいないように見えた…
		;解放か快感に素直か春の人で痛みに弱いがなく、反発刻印がない場合
		ELSEIF (TALENT:解放 || TALENT:快感に素直 || TALENT:春の人) && TALENT:痛みに弱い == 0 && MARK:反発刻印 <= 0
			PRINTFORML なんだか楽しそうな%CALLNAME:TARGET%に強制開口器を丁寧に嵌めてあげた…
		ELSE
			PRINTFORML %CALLNAME:TARGET%に強制開口器を嵌めさせた
		ENDIF
	ENDIF
ENDIF
