;=============================================================================
;精液風呂
;=============================================================================
;奴隷を触手の精液にたっぷり漬けこむコマンド。不快の上昇率が非常に高い。
;いくら禁断の知識持ちとはいえ、流石に人型キャラのでは非現実的すぎと思ったので
;精液は触手のものを用意。そのため触手中毒もある程度ソース計算に関与。
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE366
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:366 > 0
	RETURN 0
;特殊風呂系コマンドを有効にしてないとダメ
SIF (FLAG:15 & 1024) == 0
	RETURN 0
;風呂を改装していないとダメ
SIF (FLAG:74 & 64) == 0
	RETURN 0
;一度も精液風呂に入ったことが無い場合、異常系調教フィルタがオフになってないとダメ
SIF FLAG:2 & 4 && (CFLAG:23 & 8) == 0
	RETURN 0
;解除はいつでも可能
SIF TEQUIP:特殊風呂入浴中 == 8
	RETURN 1
;主人か助手のどちらかが禁断の知識をもっていないとダメ
IF ASSI >= 0
	SIF TALENT:MASTER:禁断の知識 == 0 && TALENT:ASSI:禁断の知識 == 0
		RETURN 0
ELSE
	SIF TALENT:MASTER:禁断の知識 == 0
		RETURN 0
ENDIF
;調教者が触手使役術を持っていないとダメ
SIF TALENT:PLAYER:触手使役術 == 0
	RETURN 0
;対象が汚臭敏感を持っているかつ精液中毒がLv0のときはダメ
SIF TALENT:汚臭敏感 && ABL:精液中毒 == 0
	RETURN 0
;機械だとダメ
SIF TALENT:機械
	RETURN 0
;睡眠中は不可
SIF EQUIP:睡眠薬
	RETURN 0
;失神中は不可
SIF TFLAG:899 > 0
	RETURN 0
;電極使用中は不可
SIF TEQUIP:Ｖ系装着器具 == 4 || TEQUIP:Ａ系装着器具 == 4 || TEQUIP:Ｃ系装着器具 == 4 || TEQUIP:Ｃ系装着器具 == 6 || TEQUIP:Ｕ系装着器具 == 4 || TEQUIP:Ｂ系装着器具 == 4
	RETURN 0
;蜘蛛の巣にかけているときはダメ
SIF TEQUIP:緊縛関連 == 7
	RETURN 0
;乗馬中はダメ
SIF TEQUIP:三角木馬乗馬中
	RETURN 0
;野外はダメ
SIF TEQUIP:野外プレイ
	RETURN 0
;お風呂場プレイ中はダメ
SIF TEQUIP:お風呂場プレイ
	RETURN 0
;他の○○風呂入浴中はダメ
SIF TEQUIP:特殊風呂入浴中 && TEQUIP:特殊風呂入浴中 != 8
	RETURN 0
;お医者さんプレイ中はダメ
SIF TEQUIP:お医者さんプレイ
	RETURN 0
;オムツプレイ中はダメ
SIF TEQUIP:オムツプレイ
	RETURN 0
;コスプレ中はダメ
SIF TEQUIP:コスチュームプレイ > 2
	RETURN 0
;裸エプロン中はダメ
SIF TEQUIP:コスチュームプレイ == 1
	RETURN 0
;時止め中は無理
SIF TEQUIP:時間止め
	RETURN 0
;触手調教中はダメ
SIF TEQUIP:触手調教
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 366) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM366
PRINTL 精液風呂

;戦闘判定
CALL COM_TRY_BATTLE, 366
;実行できない
SIF RESULT == 1
	RETURN 1

TSTR:0 = 精液風呂
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

IF TEQUIP:特殊風呂入浴中 == 8
	DOWNBASE:0 += 50
	DOWNBASE:1 += 150
	TEQUIP:特殊風呂入浴中 = 0
	;調教者の手に精液が付く
	STAIN:PLAYER:手 |= 4
	RETURN 1
ENDIF

LOCAL:1 = 300
;ABL:精液中毒をみる
IF ABL:精液中毒 == 0
	TIMES LOCAL:1 , 2.00
ELSEIF ABL:精液中毒 == 1
	TIMES LOCAL:1 , 1.50
ELSEIF ABL:精液中毒 == 2
	TIMES LOCAL:1 , 1.00
ELSEIF ABL:精液中毒 == 3
	TIMES LOCAL:1 , 0.80
ELSEIF ABL:精液中毒 == 4
	TIMES LOCAL:1 , 0.75
ELSE
	TIMES LOCAL:1 , 0.66
ENDIF

;ABL:触手中毒をみる
IF ABL:触手中毒 == 0
	TIMES LOCAL:1 , 1.00
ELSEIF ABL:触手中毒 == 1
	TIMES LOCAL:1 , 0.95
ELSEIF ABL:触手中毒 == 2
	TIMES LOCAL:1 , 0.90
ELSEIF ABL:触手中毒 == 3
	TIMES LOCAL:1 , 0.85
ELSEIF ABL:触手中毒 == 4
	TIMES LOCAL:1 , 0.80
ELSE
	TIMES LOCAL:1 , 0.75
ENDIF

;汚臭鈍感、敏感、汚れ無視
IF TALENT:汚臭鈍感 && TALENT:汚れ無視 == 0
	TIMES LOCAL:1 , 0.75
ELSEIF TALENT:汚臭敏感 && TALENT:汚れ無視 == 0
	TIMES LOCAL:1 , 1.50
ENDIF

DOWNBASE:0 += 25 + LOCAL:1 /10
DOWNBASE:1 += LOCAL:1

SOURCE:中毒充足 = 1000
SOURCE:不潔 = 4000
SOURCE:屈従 = 750
SOURCE:逸脱 = 2500

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES SOURCE:中毒充足 , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES SOURCE:中毒充足 , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES SOURCE:中毒充足 , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES SOURCE:中毒充足 , 1.10
ELSE
	TIMES SOURCE:中毒充足 , 1.20
ENDIF

;ABL:従順をみる
IF ABL:従順 == 0
	TIMES SOURCE:屈従 , 0.80
ELSEIF ABL:従順 == 1
	TIMES SOURCE:屈従 , 0.90
ELSEIF ABL:従順 == 2
	TIMES SOURCE:屈従 , 1.00
ELSEIF ABL:従順 == 3
	TIMES SOURCE:屈従 , 1.10
ELSEIF ABL:従順 == 4
	TIMES SOURCE:屈従 , 1.20
ELSE
	TIMES SOURCE:屈従 , 1.30
ENDIF

;ABL:精液中毒をみる
IF ABL:精液中毒 == 0
	TIMES SOURCE:中毒充足 , 0.70
	TIMES SOURCE:不潔 , 4.50
	TIMES SOURCE:屈従 , 0.50
	TIMES SOURCE:逸脱 , 2.50
ELSEIF ABL:精液中毒 == 1
	TIMES SOURCE:中毒充足 , 0.80
	TIMES SOURCE:不潔 , 2.30
	TIMES SOURCE:屈従 , 0.75
	TIMES SOURCE:逸脱 , 1.75
ELSEIF ABL:精液中毒 == 2
	TIMES SOURCE:中毒充足 , 0.90
	TIMES SOURCE:不潔 , 1.10
	TIMES SOURCE:屈従 , 1.00
	TIMES SOURCE:逸脱 , 1.00
ELSEIF ABL:精液中毒 == 3
	TIMES SOURCE:中毒充足 , 1.00
	TIMES SOURCE:不潔 , 0.80
	TIMES SOURCE:屈従 , 1.10
	TIMES SOURCE:逸脱 , 0.50
ELSEIF ABL:精液中毒 == 4
	TIMES SOURCE:中毒充足 , 1.20
	TIMES SOURCE:不潔 , 0.60
	TIMES SOURCE:屈従 , 1.30
	TIMES SOURCE:逸脱 , 0.25
ELSE
	TIMES SOURCE:中毒充足 , 1.40
	TIMES SOURCE:不潔 , 0.20
	TIMES SOURCE:屈従 , 1.50
	TIMES SOURCE:逸脱 , 0.10
ENDIF

;ABL:触手中毒をみる
IF ABL:触手中毒 == 0
	TIMES SOURCE:中毒充足 , 0.70
	TIMES SOURCE:不潔 , 4.50
	TIMES SOURCE:屈従 , 0.50
	TIMES SOURCE:逸脱 , 2.50
ELSEIF ABL:触手中毒 == 1
	TIMES SOURCE:中毒充足 , 0.80
	TIMES SOURCE:不潔 , 2.30
	TIMES SOURCE:屈従 , 0.75
	TIMES SOURCE:逸脱 , 1.75
ELSEIF ABL:触手中毒 == 2
	TIMES SOURCE:中毒充足 , 0.90
	TIMES SOURCE:不潔 , 1.10
	TIMES SOURCE:屈従 , 1.00
	TIMES SOURCE:逸脱 , 1.00
ELSEIF ABL:触手中毒 == 3
	TIMES SOURCE:中毒充足 , 1.00
	TIMES SOURCE:不潔 , 0.80
	TIMES SOURCE:屈従 , 1.10
	TIMES SOURCE:逸脱 , 0.50
ELSEIF ABL:触手中毒 == 4
	TIMES SOURCE:中毒充足 , 1.20
	TIMES SOURCE:不潔 , 0.60
	TIMES SOURCE:屈従 , 1.30
	TIMES SOURCE:逸脱 , 0.25
ELSE
	TIMES SOURCE:中毒充足 , 1.40
	TIMES SOURCE:不潔 , 0.20
	TIMES SOURCE:屈従 , 1.50
	TIMES SOURCE:逸脱 , 0.10
ENDIF

;汚臭鈍感、敏感、汚れ無視
IF TALENT:汚臭鈍感 && TALENT:汚れ無視 == 0
	TIMES SOURCE:中毒充足 , 1.20
	TIMES SOURCE:不潔 , 0.80
	TIMES SOURCE:屈従 , 1.10
	TIMES SOURCE:逸脱 , 0.75
ELSEIF TALENT:汚臭敏感 && TALENT:汚れ無視 == 0
	TIMES SOURCE:中毒充足 , 0.70
	TIMES SOURCE:不潔 , 2.50
	TIMES SOURCE:屈従 , 0.60
	TIMES SOURCE:逸脱 , 1.80
ENDIF

;パイパン
IF TALENT:パイパン
	TIMES SOURCE:中毒充足 , 1.30
	TIMES SOURCE:屈従 , 1.30
ENDIF

TCVAR:精液経験 += 2
SIF RAND:3 == 0
	CFLAG:3666 += 1
IF CFLAG:3666 * 3 > 20
	VARSET LOCALS
	$RAND_1_LOOP
	REPEAT 3
		LOCAL:COUNT = RAND:2
			REND
	SIF LOCAL:0 + LOCAL:1 + LOCAL:2 > 1 && LOCAL:0 + LOCAL:1 + LOCAL:2 < 0
		GOTO RAND_1_LOOP
	REPEAT 3
		CFLAG:(71 + COUNT) = MAX(CFLAG:(71 + COUNT) - LOCAL:COUNT, 0)
	REND
ENDIF

IF (CFLAG:23 & 8) == 0
	TCVAR:異常経験 += 1
	CFLAG:23 |= 8
ENDIF

;精液を飲んだフラグ
TFLAG:3 = 1
;精液風呂入浴
TEQUIP:特殊風呂入浴中 = 8
RETURN 1

;--------------------------------------------------
;精液風呂入浴中
;--------------------------------------------------
@EQUIP_COM366
PRINTL ＜精液風呂入浴中＞

LOCAL = 250
LOCAL:1 = 1000
LOCAL:2 = 200
LOCAL:3 = 800
LOCAL:4 = 100

;ABL:精液中毒をみる
IF ABL:精液中毒 == 0
	TIMES LOCAL , 0.70
	TIMES LOCAL:1 , 4.50
	TIMES LOCAL:2 , 0.50
	TIMES LOCAL:3 , 2.50
	TIMES LOCAL:4 , 2.00
ELSEIF ABL:精液中毒 == 1
	TIMES LOCAL , 0.80
	TIMES LOCAL:1 , 2.30
	TIMES LOCAL:2 , 0.75
	TIMES LOCAL:3 , 1.75
	TIMES LOCAL:4 , 1.50
ELSEIF ABL:精液中毒 == 2
	TIMES LOCAL , 0.90
	TIMES LOCAL:1 , 1.10
	TIMES LOCAL:2 , 1.00
	TIMES LOCAL:3 , 1.00
	TIMES LOCAL:4 , 1.00
ELSEIF ABL:精液中毒 == 3
	TIMES LOCAL , 1.00
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:2 , 1.10
	TIMES LOCAL:3 , 0.50
	TIMES LOCAL:4 , 0.80
ELSEIF ABL:精液中毒 == 4
	TIMES LOCAL , 1.20
	TIMES LOCAL:1 , 0.60
	TIMES LOCAL:2 , 1.30
	TIMES LOCAL:3 , 0.25
	TIMES LOCAL:4 , 0.75
ELSE
	TIMES LOCAL , 1.40
	TIMES LOCAL:1 , 0.20
	TIMES LOCAL:2 , 1.50
	TIMES LOCAL:3 , 0.10
	TIMES LOCAL:4 , 0.66
ENDIF

;ABL:触手中毒をみる
IF ABL:触手中毒 == 0
	TIMES LOCAL , 0.70
	TIMES LOCAL:1 , 4.50
	TIMES LOCAL:2 , 0.50
	TIMES LOCAL:3 , 2.50
	TIMES LOCAL:4 , 1.00
ELSEIF ABL:触手中毒 == 1
	TIMES LOCAL , 0.80
	TIMES LOCAL:1 , 2.30
	TIMES LOCAL:2 , 0.75
	TIMES LOCAL:3 , 1.75
	TIMES LOCAL:4 , 0.95
ELSEIF ABL:触手中毒 == 2
	TIMES LOCAL , 0.90
	TIMES LOCAL:1 , 1.10
	TIMES LOCAL:2 , 1.00
	TIMES LOCAL:3 , 1.00
	TIMES LOCAL:4 , 0.90
ELSEIF ABL:触手中毒 == 3
	TIMES LOCAL , 1.00
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:2 , 1.10
	TIMES LOCAL:3 , 0.50
	TIMES LOCAL:4 , 0.85
ELSEIF ABL:触手中毒 == 4
	TIMES LOCAL , 1.20
	TIMES LOCAL:1 , 0.60
	TIMES LOCAL:2 , 1.30
	TIMES LOCAL:3 , 0.25
	TIMES LOCAL:4 , 0.80
ELSE
	TIMES LOCAL , 1.40
	TIMES LOCAL:1 , 0.20
	TIMES LOCAL:2 , 1.50
	TIMES LOCAL:3 , 0.10
	TIMES LOCAL:4 , 0.75
ENDIF

;汚臭鈍感、敏感、汚れ無視
IF TALENT:汚臭鈍感 && TALENT:汚れ無視 == 0
	TIMES LOCAL , 1.20
	TIMES LOCAL:1 , 0.80
	TIMES LOCAL:2 , 1.10
	TIMES LOCAL:3 , 0.75
	TIMES LOCAL:4 , 0.75
ELSEIF TALENT:汚臭敏感 && TALENT:汚れ無視 == 0
	TIMES LOCAL , 0.70
	TIMES LOCAL:1 , 2.50
	TIMES LOCAL:2 , 0.60
	TIMES LOCAL:3 , 1.80
	TIMES LOCAL:4 , 1.50
ENDIF

;パイパン
IF TALENT:パイパン
	TIMES LOCAL , 1.30
	TIMES LOCAL:2 , 1.30
ENDIF

DOWNBASE:0 += 5 + LOCAL:4 /15
DOWNBASE:1 += LOCAL:4

SOURCE:中毒充足 += LOCAL
SOURCE:不潔 += LOCAL:1
SOURCE:屈従 += LOCAL:2
SOURCE:逸脱 += LOCAL:3

;奴隷は全身精液まみれになる
STAIN:口 |= 4
STAIN:手 |= 4
STAIN:ペニス |= 4
STAIN:ヴァギナ |= 4
STAIN:アナル |= 4
STAIN:胸 |= 4
STAIN:足 |= 4
STAIN:髪 |= 4

TCVAR:精液経験 += 1 
SIF RAND:3 == 0
	CFLAG:3666 += RAND:2
IF CFLAG:3666 * 3 > 20
	VARSET LOCALS
	$RAND_1_LOOP
	REPEAT 3
		LOCAL:COUNT = RAND:2
			REND
	SIF LOCAL:0 + LOCAL:1 + LOCAL:2 > 1 && LOCAL:0 + LOCAL:1 + LOCAL:2 < 0
		GOTO RAND_1_LOOP
	REPEAT 3
		CFLAG:(71 + COUNT) = MAX(CFLAG:(71 + COUNT) - LOCAL:COUNT, 0)
	REND
ENDIF

;精液を飲んだフラグ
TFLAG:3 = 1
RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_366
IF TEQUIP:特殊風呂入浴中 == 8
	PRINTFORML 精液まみれになった%CALLNAME:TARGET%を風呂から引き揚げた
ELSE
	PRINTFORML %CALLNAME:TARGET%を触手の精液で満たされた風呂へと突き落した
	PRINTFORM %CALLNAME:TARGET%は
	SIF TEQUIP:鼻装着器具 == 1
		PRINTL 醜く持ち上げられた鼻をひくつかせながら、
	IF ABL:精液中毒 == 0
		PRINTL 苦々しい表情を浮かべ、落とされた際に飲み込んでしまったのか何かを吐き出すような仕草をしている…
	ELSEIF ABL:精液中毒 == 1
		PRINTL 精液の汚臭に眉毛をハの字にしてしかめっ面を浮かべている…
	ELSEIF ABL:精液中毒 == 2
		PRINTL いつの間にか精液の味や匂いに慣れてきたことに戸惑いを感じたのか、どこか腑に落ちない表情を浮かべている…
	ELSEIF ABL:精液中毒 == 3
		PRINTL あまり嫌悪感を感じなくなったのか、少しだけ精液の匂いを堪能しているようだ…
	ELSEIF ABL:精液中毒 == 4
		PRINTL 精液の匂いを嗅ぐに飽き足りないのか、積極的に飲もうとしている…
	ELSE
		PRINTL 心ゆくまでに精液の匂いを堪能している
		IF TEQUIP:口装着器具 == 1
			PRINTFORML それどころか%CALLNAME:TARGET%はボールギャグ越しに精液を飲もうとあくせくしているようだ…
		ELSEIF TEQUIP:口装着器具 == 3
			PRINTFORML それどころか%CALLNAME:TARGET%は強制開口器越しに精液を飲もうとあくせくしているようだ…
		ELSE
			IF TEQUIP:緊縛関連
				PRINTFORML %CALLNAME:TARGET%は手で精液をすくい取れないのをもどかしく感じているのか
				PRINTL 一生懸命舌を突き出し、舐め取ろうと躍起になっているように見える…
			ELSE
				PRINTFORML %CALLNAME:TARGET%はどこか虚ろな笑みを浮かべ、時折手で白濁液をすくい上げては
				PRINTL コクコクと喉を鳴らして飲み干している……
			ENDIF
		ENDIF
	ENDIF
ENDIF
