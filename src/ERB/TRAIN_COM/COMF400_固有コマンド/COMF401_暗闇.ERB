;=============================================================================
;暗闇
;=============================================================================
;アイマスクのコピー
;要求の機能はほとんどCOMABLE.ERBの方で実現している
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE401
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:401 > 0
	RETURN 0
;キャラ専用コマンドを有効にしてないとダメ
SIF (FLAG:15 & 16384) == 0
	RETURN 0
;調教者がルーミアでないとダメ
SIF NO:PLAYER != 1003
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 401) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM401
PRINTL 暗闇

;戦闘判定
CALL COM_TRY_BATTLE, 401
;実行できない
SIF RESULT == 1
	RETURN 1

TSTR:0 = 暗闇
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

DOWNBASE:0 += 0
DOWNBASE:1 += 50

LOCAL:1 = 250
SOURCE:露出 = 1000
SOURCE:逸脱 = 500

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL:1 , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL:1 , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL:1 , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL:1 , 1.10
ELSE
	TIMES LOCAL:1 , 1.20
ENDIF

;ABL:従順をみる
IF ABL:従順 == 0
	TIMES LOCAL:1 , 0.40
ELSEIF ABL:従順 == 1
	TIMES LOCAL:1 , 0.60
ELSEIF ABL:従順 == 2
	TIMES LOCAL:1 , 0.80
ELSEIF ABL:従順 == 3
	TIMES LOCAL:1 , 1.00
ELSEIF ABL:従順 == 4
	TIMES LOCAL:1 , 1.10
ELSE
	TIMES LOCAL:1 , 1.20
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES LOCAL:1 , 0.80
ELSEIF ABL:マゾっ気 == 1
	TIMES LOCAL:1 , 1.00
ELSEIF ABL:マゾっ気 == 2
	TIMES LOCAL:1 , 1.30
ELSEIF ABL:マゾっ気 == 3
	TIMES LOCAL:1 , 1.60
ELSEIF ABL:マゾっ気 == 4
	TIMES LOCAL:1 , 2.00
ELSE
	TIMES LOCAL:1 , 3.00
ENDIF

;臆病
SIF TALENT:臆病
	TIMES SOURCE:逸脱 , 2.00
;倒錯的
SIF TALENT:倒錯的
	TIMES LOCAL:1 , 2.00

SOURCE:液体追加 += LOCAL:1
SOURCE:欲情追加 += LOCAL:1

;暗闇の着脱
IF TEQUIP:暗闇
	TEQUIP:暗闇 = 0
ELSE
	TEQUIP:暗闇 = 1
ENDIF
RETURN 1

;--------------------------------------------------
;暗闇展開中
;--------------------------------------------------
@EQUIP_COM401
PRINTL ＜暗闇展開中＞

DOWNBASE:0 += 0
DOWNBASE:1 += 50

LOCAL = 250
LOCAL:1 = 1000
LOCAL:2 = 500

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL , 1.10
ELSE
	TIMES LOCAL , 1.20
ENDIF

;ABL:従順をみる
IF ABL:従順 == 0
	TIMES LOCAL , 0.40
ELSEIF ABL:従順 == 1
	TIMES LOCAL , 0.60
ELSEIF ABL:従順 == 2
	TIMES LOCAL , 0.80
ELSEIF ABL:従順 == 3
	TIMES LOCAL , 1.00
ELSEIF ABL:従順 == 4
	TIMES LOCAL , 1.10
ELSE
	TIMES LOCAL , 1.20
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES LOCAL , 0.80
ELSEIF ABL:マゾっ気 == 1
	TIMES LOCAL , 1.00
ELSEIF ABL:マゾっ気 == 2
	TIMES LOCAL , 1.30
ELSEIF ABL:マゾっ気 == 3
	TIMES LOCAL , 1.60
ELSEIF ABL:マゾっ気 == 4
	TIMES LOCAL , 2.00
ELSE
	TIMES LOCAL , 3.00
ENDIF

;倒錯的
SIF TALENT:倒錯的
	TIMES LOCAL , 2.00

SOURCE:トラウマ += LOCAL:2

;臆病
SIF TALENT:臆病
	TIMES LOCAL:2 , 2.00

SOURCE:液体追加 += LOCAL
SOURCE:露出 += LOCAL:1
SOURCE:逸脱 += LOCAL:2
SOURCE:欲情追加 += LOCAL

IF TALENT:オトコ == 0 && TALENT:PLAYER:オトコ == 0
	TCVAR:レズ経験 += 1
ELSEIF TALENT:オトコ && TALENT:PLAYER:オトコ
	TCVAR:ＢＬ経験 += 1
ENDIF
RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_401
IF TEQUIP:暗闇
	PRINTFORML %CALLNAME:PLAYER%は能力を解除した
ELSE
	PRINTFORML %CALLNAME:PLAYER%は能力を展開し、辺りは闇に包まれた
ENDIF
