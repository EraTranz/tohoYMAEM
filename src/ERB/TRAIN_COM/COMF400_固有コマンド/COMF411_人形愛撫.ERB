;=============================================================================
;人形愛撫
;=============================================================================
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE411
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:411 > 0
	RETURN 0
;キャラ専用コマンドを有効にしてないとダメ
SIF (FLAG:15 & 16384) == 0
	RETURN 0
;Ｖ調教フィルタがオフになってないとダメ
SIF FLAG:2 & 1
	RETURN 0
;調教者がＥＸ化していないアリスでないとダメ
SIF NO:PLAYER != 1014 || CFLAG:PLAYER:0
	RETURN 0
;人形愛撫残り使用可能回数オーバー
SIF TFLAG:141 > 3
	RETURN 0
;対象が～感覚を1つも持っていないならダメ
SIF ABL:Ｃ感覚 <= 0 && ABL:Ｖ感覚 <= 0 && ABL:Ａ感覚 <= 0 && ABL:Ｂ感覚 <= 0
	RETURN 0
;対象にペニスがあるならダメ
SIF EXIST_BAR(TARGET)
	RETURN 0
;調教者の技巧が3無いとできない
SIF ABL:PLAYER:技巧 < 3
	RETURN 0
;Ｖ系装着具使用中は不可
SIF TEQUIP:Ｖ系装着器具 || TEQUIP:クスコ
	RETURN 0
;Ａ系装着具使用中は不可
SIF TEQUIP:Ａ系装着器具 || TEQUIP:氷柱
	RETURN 0
;乗馬中はダメ
SIF TEQUIP:三角木馬乗馬中
	RETURN 0
;お風呂場プレイ中はダメ
SIF TEQUIP:お風呂場プレイ
	RETURN 0
;○○風呂入浴中はダメ
SIF TEQUIP:特殊風呂入浴中
	RETURN 0
;オムツプレイ中はダメ
SIF TEQUIP:オムツプレイ
	RETURN 0
;裸エプロン、スク水プレイ、コスプレ中はダメ
SIF TEQUIP:コスチュームプレイ
	RETURN 0
;触手調教中はダメ
SIF TEQUIP:触手調教
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 411) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM411
;………………………………………………
;コマンドの派生判定
;………………………………………………
;連続で使うと拘束∇に発展することがある
IF PREVCOM == 411
	SIF EXCOM_ABLE658() == 1
		JUMP COM658
ENDIF

PRINTL 人形愛撫

;戦闘判定
CALL COM_TRY_BATTLE, 411
;実行できない
SIF RESULT == 1
	RETURN 1

TSTR:0 = 人形愛撫

DOWNBASE:0 += 15
DOWNBASE:1 += 75

;-------------------------------------------------
;ソースの計算
;-------------------------------------------------

SOURCE:性行動 = 60
SOURCE:露出 = 200
SOURCE:逸脱 = 800

;ここでコマンド使用回数をプラス
TFLAG:141 += 1

IF ABL:Ｃ感覚 > 0
	LOCAL:1 = 1
	SIF ABL:Ｃ感覚 > 3
		LOCAL:1 += 1
ELSEIF ABL:Ｖ感覚 > 0
	LOCAL:2 = 1
	SIF ABL:Ｖ感覚 > 3
		LOCAL:2 += 1
ELSEIF ABL:Ａ感覚 > 0
	LOCAL:3 = 1
	SIF ABL:Ａ感覚 > 3
		LOCAL:3 += 1
ELSEIF ABL:Ｂ感覚 > 0
	LOCAL:4 = 1
	SIF ABL:Ｂ感覚 > 3
		LOCAL:4 += 1
ELSE
	LOCAL:5 = 1
ENDIF

SIF LOCAL:2 > 0 || LOCAL:3 > 0
	SOURCE:痛み = 600
SIF ABL:Ｂ感覚 > 0
	SOURCE:屈従 = 500

;ABL:Ｃ感覚をみる
IF ABL:Ｃ感覚 == 0
	SOURCE:快Ｃ = 0
ELSEIF ABL:Ｃ感覚 == 1
	SOURCE:快Ｃ = 100
	SOURCE:情愛 += 60
ELSEIF ABL:Ｃ感覚 == 2
	SOURCE:快Ｃ = 500
	SOURCE:情愛 += 120
ELSEIF ABL:Ｃ感覚 == 3
	SOURCE:快Ｃ = 1100
	SOURCE:情愛 += 240
ELSEIF ABL:Ｃ感覚 == 4
	SOURCE:快Ｃ = 1900
	SOURCE:情愛 += 360
ELSE
	SOURCE:快Ｃ = 2700
	SOURCE:情愛 += 600
ENDIF

;ABL:Ｖ感覚をみる
IF ABL:Ｖ感覚 == 0
	SOURCE:快Ｖ = 0
ELSEIF ABL:Ｖ感覚 == 1
	SOURCE:快Ｖ = 50
	SOURCE:屈従 += 100
ELSEIF ABL:Ｖ感覚 == 2
	SOURCE:快Ｖ = 200
	SOURCE:屈従 += 150
ELSEIF ABL:Ｖ感覚 == 3
	SOURCE:快Ｖ = 600
	SOURCE:屈従 += 300
ELSEIF ABL:Ｖ感覚 == 4
	SOURCE:快Ｖ = 1200
	SOURCE:屈従 += 600
ELSE
	SOURCE:快Ｖ = 1800
	SOURCE:屈従 += 700
ENDIF

;ABL:Ａ感覚をみる
IF ABL:Ａ感覚 == 0
	SOURCE:快Ａ = 0
ELSEIF ABL:Ａ感覚 == 1
	SOURCE:快Ａ = 75
	SOURCE:屈従 += 100
ELSEIF ABL:Ａ感覚 == 2
	SOURCE:快Ａ = 150
	SOURCE:屈従 += 250
ELSEIF ABL:Ａ感覚 == 3
	SOURCE:快Ａ = 400
	SOURCE:屈従 += 500
ELSEIF ABL:Ａ感覚 == 4
	SOURCE:快Ａ = 800
	SOURCE:屈従 += 800
ELSE
	SOURCE:快Ａ = 1300
	SOURCE:屈従 += 1200
ENDIF

;ABL:Ｂ感覚をみる
IF ABL:Ｂ感覚 == 0
	SOURCE:快Ｂ = 0
ELSEIF ABL:Ｂ感覚 == 1
	SOURCE:快Ｂ = 100
	SOURCE:情愛 += 50
ELSEIF ABL:Ｂ感覚 == 2
	SOURCE:快Ｂ = 400
	SOURCE:情愛 += 100
ELSEIF ABL:Ｂ感覚 == 3
	SOURCE:快Ｂ = 1000
	SOURCE:情愛 += 200
ELSEIF ABL:Ｂ感覚 == 4
	SOURCE:快Ｂ = 1700
	SOURCE:情愛 += 320
ELSE
	SOURCE:快Ｂ = 2500
	SOURCE:情愛 += 450
ENDIF

;Ｃ敏感、鈍感をみる
;快Ｃ自体のチェックは後でまとめてやる
IF TALENT:Ｃ敏感
	TIMES SOURCE:快Ｃ , 1.50
ELSEIF TALENT:Ｃ鈍感
	TIMES SOURCE:快Ｃ , 0.60
ENDIF
;Ｖ敏感、鈍感をみる
;快Ｖ自体のチェックは後でまとめてやる
IF TALENT:Ｖ敏感
	TIMES SOURCE:快Ｖ , 1.50
ELSEIF TALENT:Ｖ鈍感
	TIMES SOURCE:快Ｖ , 0.60
ENDIF
;Ａ敏感、鈍感をみる
;快Ａ自体のチェックは後でまとめてやる
IF TALENT:Ａ敏感
	TIMES SOURCE:快Ａ , 1.50
ELSEIF TALENT:Ａ鈍感
	TIMES SOURCE:快Ａ , 0.60
ENDIF
;Ｂ敏感、鈍感をみる
;快Ｂ自体のチェックは後でまとめてやる
IF TALENT:Ｂ敏感
	TIMES SOURCE:快Ｂ , 1.50
ELSEIF TALENT:Ｂ鈍感
	TIMES SOURCE:快Ｂ , 0.60
ENDIF

;PALAM:潤滑をみる
IF PALAM:潤滑 < PALAMLV:1
	TIMES SOURCE:快Ｖ , 0.10
	TIMES SOURCE:快Ａ , 0.10
	TIMES SOURCE:屈従, 0.10
	TIMES SOURCE:痛み , 3.00
ELSEIF PALAM:潤滑 < PALAMLV:2
	TIMES SOURCE:快Ｖ , 0.20
	TIMES SOURCE:快Ａ , 0.20
	TIMES SOURCE:屈従, 0.20
	TIMES SOURCE:痛み , 2.00
ELSEIF PALAM:潤滑 < PALAMLV:3
	TIMES SOURCE:快Ｖ , 0.60
	TIMES SOURCE:快Ａ , 0.60
	TIMES SOURCE:屈従, 0.60
	TIMES SOURCE:痛み , 1.00
ELSEIF PALAM:潤滑 < PALAMLV:4
	TIMES SOURCE:快Ｖ , 1.00
	TIMES SOURCE:快Ａ , 1.00
	TIMES SOURCE:屈従, 1.00
	TIMES SOURCE:痛み , 0.50
ELSE
	TIMES SOURCE:快Ｖ , 2.00
	TIMES SOURCE:快Ａ , 2.00
	TIMES SOURCE:屈従, 2.00
	TIMES SOURCE:痛み , 0.10
ENDIF

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES SOURCE:屈従, 0.30
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES SOURCE:屈従, 0.60
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES SOURCE:屈従, 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES SOURCE:屈従, 1.30
ELSE
	TIMES SOURCE:屈従, 1.60
ENDIF

;プライド高い
SIF TALENT:プライド高い
	SOURCE:屈従 /= 2
;保守的
SIF TALENT:保守的
	SOURCE:屈従 /= 3
;恋慕
SIF TALENT:恋慕 && ASSIPLAY == 0
	SOURCE:情愛 *= 2

;縄で緊縛中のときは効果大
IF TEQUIP:緊縛関連
	TIMES SOURCE:痛み, 1.50
	TIMES SOURCE:逸脱, 1.50
ENDIF

;1回の調教中に回数を重ねると効果ダウン
LOCAL:6 = TFLAG:141
SOURCE:快Ｖ /= LOCAL:6
SOURCE:快Ａ /= LOCAL:6
SOURCE:情愛 /= LOCAL:6
SOURCE:性行動 /= LOCAL:6
SOURCE:達成感 /= LOCAL:6
SOURCE:痛み /= LOCAL:6
SOURCE:欲情追加 /= LOCAL:6
SOURCE:露出 /= LOCAL:6
SOURCE:屈従 /= LOCAL:6
SOURCE:逸脱 /= LOCAL:6
SOURCE:快Ｂ /= LOCAL:6
;口上用
TFLAG:190 = LOCAL:1
TFLAG:191 = LOCAL:2
TFLAG:192 = LOCAL:3
TFLAG:193 = LOCAL:4

CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

IF TALENT:オトコ == 0 && TALENT:PLAYER:オトコ == 0
	TCVAR:レズ経験 += 5
ELSEIF TALENT:オトコ && TALENT:PLAYER:オトコ
	TCVAR:ＢＬ経験 += 5
ENDIF

RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
;TFLAG:190 = 対象のＣ感覚による開発度（最優先）
;TFLAG:191 = 対象のＶ感覚による開発度（２番目）
;TFLAG:192 = 対象のＡ感覚による開発度（３番目）
;TFLAG:193 = 対象のＢ感覚による開発度（４番目）
@SYSTXT_TRAIN_MESSAGE_F_COM_411
PRINTFORML %CALLNAME:PLAYER%が呼び出した大量の人形が、%CALLNAME:TARGET%の体へと群がっていった…

PRINTFORM 人形達は%CALLNAME:TARGET%の
IF TFLAG:190 == 2 && TFLAG:191 == 2 && TFLAG:192 == 2 && TFLAG:193 == 2
	PRINTL これ以上できないほど開発されたありとあらゆる性感帯を無慈悲なまでに蹂躙している…
ELSEIF TFLAG:190 == 1 && TFLAG:191 == 1 && TFLAG:192 == 1 && TFLAG:193 == 1
	PRINTL ありとあらゆる性感帯を開発するべく執拗なまでに責めたてている…
ELSEIF TFLAG:190 == 2 && TFLAG:191 == 2 && TFLAG:192 == 2
	PRINTL 開発されつくした下半身へ集中的に手を伸ばしている…
ELSEIF TFLAG:190 == 1 && TFLAG:191 == 1 && TFLAG:192 == 1
	PRINTL 下半身に殺到し、その性器にさらなる快感を刻みこむかのごとく舐めまわしている…
ELSEIF TFLAG:191 == 2 && TFLAG:192 == 2
	PRINTFORML 緩みきった前後の穴に時々指を突っ込み、%CALLNAME:TARGET%の反応を楽しんでいるようだ…
ELSEIF TFLAG:191 == 1 && TFLAG:192 == 1
	PRINTL 膣口と菊門に新たな快楽を植え付けさせるように弄んでいる
ELSEIF TFLAG:190 == 2 && TFLAG:193 == 2
	PRINTL 性感帯と化した全身にくまなく指を這わせている…
ELSEIF TFLAG:190 == 1 && TFLAG:193 == 1
	PRINTL 全身を緩急つけた動きで撫でまわしている…
ELSEIF TFLAG:190 == 2
	PRINTL 膨れ上がって敏感になった陰核を中心に責め立てている…
ELSEIF TFLAG:191 == 2
	PRINTL 愛液で濡れている陰唇に手を入れ、膣の中をかき回して遊んでいるように見える…
ELSEIF TFLAG:192 == 2
	PRINTL 相次ぐ調教で緩みきった後ろの穴に指を入れながら全身をまさぐっている…
ELSEIF TFLAG:193 == 2
	PRINTL 尖りきった乳頭を絶妙なタイミングで弾きながら体中を撫でまわしている…
ELSE
	SIF TFLAG:190 == 1
		PRINT クリトリスを
	SIF TFLAG:190 == 1 && (TFLAG:191 ==1 || TFLAG:192 == 1 || TFLAG:193 == 1)
		PRINT 、
	SIF TFLAG:191 == 1
		PRINT ヴァギナを
	SIF TFLAG:191 == 1 && (TFLAG:192 == 1 || TFLAG:193 == 1)
		PRINT 、
	SIF TFLAG:192 == 1
		PRINT アナルを
	SIF TFLAG:192 == 1 && TFLAG:193 == 1
		PRINT 、
	SIF TFLAG:193 == 1
		PRINT バストを
	PRINTL 弄り倒している…
ENDIF

IF EQUIP:睡眠薬 || TFLAG:899 > 0
	PRINTFORML %CALLNAME:TARGET%は、人形達の責めに無意識に抵抗しているのか手や足をぱたぱたと動かしている
ELSEIF TEQUIP:緊縛関連 && TEQUIP:目装着器具 && TEQUIP:口装着器具
	PRINTFORML 視野も言葉も自由も奪われた%CALLNAME:TARGET%はなすすべもなく人形達の責めに身を委ねている
ELSEIF TEQUIP:緊縛関連 == 0 && TEQUIP:目装着器具 == 0 && TEQUIP:口装着器具 == 0
	PRINTFORML %CALLNAME:TARGET%は懸命に抵抗するものの、大量の人形に押さえつけられて身動きが取れないようだ
ELSE
	PRINTFORM %CALLNAME:TARGET%は
	IF TEQUIP:緊縛関連 && TEQUIP:口装着器具
		PRINTL 手足は拘束され、口に猿轡をかませられて罵声の一つもあげることができず
		PRINTL ただ人形達に弄ばれている自分の体を見るめることしかできずにいた…
	ELSEIF TEQUIP:緊縛関連 && TEQUIP:目装着器具
		PRINTL 目を覆われ、体は束縛されて動くことができずにいた
		PRINTL 人形達に埋もれ弄ばれて、唯一自由だった口すらも今は愛撫でもたらされる刺激によって嬌声を上げるばかりだ…
	ELSEIF TEQUIP:目装着器具 && TEQUIP:口装着器具
		PRINTL 布で視野を塞がれ、口枷をつけられてもなお暴れようともがくが
		PRINTL 圧倒的な数に押さえつけられてなすすべもなく人形達に弄ばれている…
	ELSEIF TEQUIP:4
		PRINTL 縛り付けられて身動きが取れず、ロクな抵抗もできないまま人形達に弄ばれている…
	ELSEIF TEQUIP:目装着器具
		PRINTL 視界を奪われ、断続的に聞こえる卑猥な音と自分の肌が蹂躙されている恐怖に震えながら人形達に弄ばれている…
	ELSEIF TEQUIP:口装着器具
		PRINTL ボールギャグを咥えさせられ、叫び声を上げることもできずに人形達に弄ばれている…
	ENDIF
ENDIF
