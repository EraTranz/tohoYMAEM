;=============================================================================
;読心
;=============================================================================
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE415
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:415 > 0
	RETURN 0
;キャラ専用コマンドを有効にしてないとダメ
SIF (FLAG:15 & 16384) == 0
	RETURN 0
;調教者が心の目を閉ざしていない[覚]でないとダメ
SIF TALENT:PLAYER:覚 != 1
	RETURN 0
;助手調教時は[恋慕]持ちじゃないとダメ
SIF ASSIPLAY && TALENT:ASSI:恋慕 == 0
	RETURN 0
;対象が心の目を閉ざしている[覚]だとダメ
SIF TALENT:覚 == 2
	RETURN 0
;触手読心責め中はダメ
SIF TEQUIP:巨大化 == 2
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 415) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM415
IF TEQUIP:読心
	PRINTL 読心中断

	;戦闘判定
	CALL COM_TRY_BATTLE, 415
	;実行できない
	SIF RESULT == 1
		RETURN 1

	TSTR:0 = 読心中断
ELSE
	PRINTL 読心開始

	;戦闘判定
	CALL COM_TRY_BATTLE, 415
	;実行できない
	SIF RESULT == 1
		RETURN 1

	TSTR:0 = 読心開始
ENDIF
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

;読心のセット
;終了時は修正なし
IF TEQUIP:読心
	TEQUIP:読心 = 0
	RETURN 1
ENDIF

DOWNBASE:0 += 0
DOWNBASE:1 += 200

LOCAL:1 = 1000
LOCAL:2 = 1000

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL:1 , 1.00
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL:1 , 1.10
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL:1 , 1.20
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL:1 , 1.30
ELSE
	TIMES LOCAL:1 , 1.40
ENDIF

;ABL:露出癖をみる
IF ABL:露出癖 == 0
	SOURCE:中毒充足 += 0
	SOURCE:液体追加 += 0
	SOURCE:屈従 += 600
	SOURCE:逸脱 += 1000
	SOURCE:反感追加 += 1000
	TIMES LOCAL:1, 0.60
ELSEIF ABL:露出癖 == 1
	SOURCE:中毒充足 += 150
	SOURCE:液体追加 += 150
	SOURCE:屈従 += 500
	TIMES LOCAL:1, 1.00
ELSEIF ABL:露出癖 == 2
	SOURCE:中毒充足 += 300
	SOURCE:液体追加 += 300
	SOURCE:屈従 += 400
	TIMES LOCAL:1, 1.60
ELSEIF ABL:露出癖 == 3
	SOURCE:中毒充足 += 600
	SOURCE:液体追加 += 600
	SOURCE:屈従 += 300
	TIMES LOCAL:1, 2.00
ELSEIF ABL:露出癖 == 4
	SOURCE:中毒充足 += 1000
	SOURCE:液体追加 += 1000
	SOURCE:屈従 += 200
	TIMES LOCAL:1, 2.60
ELSE
	SOURCE:中毒充足 += 1800
	SOURCE:液体追加 += 1800
	SOURCE:屈従 += 100
	TIMES LOCAL:1, 3.80
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES LOCAL:1 , 1.00
ELSEIF ABL:マゾっ気 == 1
	TIMES LOCAL:1 , 1.20
ELSEIF ABL:マゾっ気 == 2
	TIMES LOCAL:1 , 1.40
ELSEIF ABL:マゾっ気 == 3
	TIMES LOCAL:1 , 1.60
ELSEIF ABL:マゾっ気 == 4
	TIMES LOCAL:1 , 1.80
ELSE
	TIMES LOCAL:1 , 2.00
ENDIF

;無関心
SIF TALENT:無関心
	TIMES LOCAL:1 , 0.80
;感情乏しい
SIF TALENT:感情乏しい
	TIMES LOCAL:1 , 0.80
;好奇心
SIF TALENT:好奇心
	TIMES LOCAL:1 , 2.50
;解放
SIF TALENT:解放
	TIMES LOCAL:1 , 1.50
;恥じらい
SIF TALENT:恥じらい
	TIMES LOCAL:2 , 3.00
;倒錯的
IF TALENT:倒錯的
	TIMES LOCAL:1 , 1.50
	TIMES LOCAL:2 , 1.20
ENDIF
;魅力
IF TALENT:魅力
	SOURCE:情愛 += 500
	SOURCE:恭順追加 += 500
	TIMES LOCAL:1 , 1.50
	TIMES LOCAL:2 , 1.20
ENDIF

SOURCE:羞恥扇情 += LOCAL:1 /2
SOURCE:トラウマ += LOCAL:2 /2

;臆病
SIF TALENT:臆病
	TIMES LOCAL:2 , 1.50

SOURCE:露出 += LOCAL:1
SOURCE:逸脱 += LOCAL:2
SOURCE:恭順追加 += LOCAL:1 /2
TEQUIP:読心 = 1
RETURN 1

;-------------------------------------------------
;読心中
;-------------------------------------------------
@EQUIP_COM415
PRINTL ＜読心中＞

DOWNBASE:0 += 10
DOWNBASE:1 += 100

LOCAL = 1000
LOCAL:1 = 1000

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL , 1.00
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL , 1.10
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL , 1.20
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL , 1.30
ELSE
	TIMES LOCAL , 1.40
ENDIF
;ABL:露出癖をみる
IF ABL:露出癖 == 0
	SOURCE:中毒充足 += 0
	SOURCE:液体追加 += 0
	SOURCE:屈従 += 600
	SOURCE:逸脱 += 1000
	SOURCE:反感追加 += 1000
	TIMES LOCAL, 0.30
ELSEIF ABL:露出癖 == 1
	SOURCE:中毒充足 += 150
	SOURCE:液体追加 += 150
	SOURCE:屈従 += 500
	TIMES LOCAL, 1.00
ELSEIF ABL:露出癖 == 2
	SOURCE:中毒充足 += 300
	SOURCE:液体追加 += 300
	SOURCE:屈従 += 400
	TIMES LOCAL, 2.00
ELSEIF ABL:露出癖 == 3
	SOURCE:中毒充足 += 600
	SOURCE:液体追加 += 600
	SOURCE:屈従 += 300
	TIMES LOCAL, 3.60
ELSEIF ABL:露出癖 == 4
	SOURCE:中毒充足 += 1000
	SOURCE:液体追加 += 1000
	SOURCE:屈従 += 200
	TIMES LOCAL, 4.60
ELSE
	SOURCE:中毒充足 += 1800
	SOURCE:液体追加 += 1800
	SOURCE:屈従 += 100
	TIMES LOCAL, 5.80
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES LOCAL , 1.10
ELSEIF ABL:マゾっ気 == 1
	TIMES LOCAL , 1.20
ELSEIF ABL:マゾっ気 == 2
	TIMES LOCAL , 1.30
ELSEIF ABL:マゾっ気 == 3
	TIMES LOCAL , 1.40
ELSEIF ABL:マゾっ気 == 4
	TIMES LOCAL , 1.60
ELSE
	TIMES LOCAL , 1.80
ENDIF

;無関心
SIF TALENT:無関心
	TIMES LOCAL , 0.80
;感情乏しい
SIF TALENT:感情乏しい
	TIMES LOCAL , 0.80
;好奇心
SIF TALENT:好奇心
	TIMES LOCAL , 2.50
;解放
SIF TALENT:解放
	TIMES LOCAL , 1.50
;恥じらい
SIF TALENT:恥じらい
	TIMES LOCAL:1 , 3.00
;倒錯的
IF TALENT:倒錯的
	TIMES LOCAL , 1.50
	TIMES LOCAL:1 , 1.20
ENDIF
;魅力
IF TALENT:魅力
	SOURCE:情愛 += 500
	SOURCE:恭順追加 += 500
	TIMES LOCAL , 1.50
	TIMES LOCAL:1 , 1.20
ENDIF

SOURCE:トラウマ += LOCAL:1 / 2

;臆病
SIF TALENT:臆病
	TIMES LOCAL:1 , 1.50

SOURCE:露出 += LOCAL
SOURCE:逸脱 += LOCAL:1
SOURCE:恭順追加 += LOCAL / 2

IF TALENT:オトコ == 0 && TALENT:PLAYER:オトコ == 0
	TCVAR:レズ経験 += 1
ELSEIF TALENT:オトコ && TALENT:PLAYER:オトコ
	TCVAR:ＢＬ経験 += 1
ENDIF

;露出快楽経験入手判定
TFLAG:100 |= 2
;主人経験フラグ
SIF ASSIPLAY == 0 && ABL:露出癖 >= 3
	TFLAG:50 += 1
RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_415
PRINTFORM %CALLNAME:PLAYER%は%CALLNAME:TARGET%の心を
IF TEQUIP:読心
	;臆病か恥じらい
	IF (TALENT:臆病 || TALENT:恥じらい) && EQUIP:睡眠薬 == 0 && TFLAG:899 == 0
		PRINTL 解放してやった
		PRINTFORML %CALLNAME:TARGET%は心底からほっとしているようだ…
	ELSE
		PRINTL 解放してやった…
	ENDIF
ELSE
	;臆病か恥じらい
	IF (TALENT:臆病 || TALENT:恥じらい) && EQUIP:睡眠薬 == 0 && TFLAG:899 == 0
		PRINTL 覗き込み始めた…
		PRINTFORML %CALLNAME:TARGET%は心を見られることに対する恐怖を感じているようだ…
	ELSE
		PRINTL 覗き込み始めた…
	ENDIF
ENDIF
