;=============================================================================
;触手アナル挿入
;=============================================================================
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE502
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:502 > 0
	RETURN 0
;解除はいつでも可能
SIF (TEQUIP:Ａ系装着器具 == 1 || TEQUIP:Ａ系装着器具 == 21) && TEQUIP:触手服 & 16
	RETURN 1
;触手調教中じゃないとダメ
SIF TEQUIP:触手調教 == 0 && TEQUIP:触手服 == 0
	RETURN 0
;Ａ調教フィルタがオフになってないとダメ
SIF FLAG:2 & 2
	RETURN 0
;他のＡ系触手責め中は不可
SIF TEQUIP:Ａ系装着器具 && TEQUIP:Ａ系装着器具 != 1 && TEQUIP:Ａ系装着器具 != 21
	RETURN 0
;責め始めた記憶がないのにすでに責められてる場合はダメ
SIF !TEQUIP:触手調教 && !(TEQUIP:触手服 & 16) && (TEQUIP:Ａ系装着器具 == 1 || TEQUIP:Ａ系装着器具 == 21)
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 502) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM502
PRINTL アナル触手

;戦闘判定
CALL COM_TRY_BATTLE, 502
;実行できない
SIF RESULT == 1
	RETURN 1

TSTR:0 = アナル触手
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

DOWNBASE:0 += 60
DOWNBASE:1 += 150

;ABL:Ａ感覚をみる
IF ABL:Ａ感覚 == 0
	SOURCE:快Ａ = 80
	SOURCE:屈従 = 300
ELSEIF ABL:Ａ感覚 == 1
	SOURCE:快Ａ = 250
	SOURCE:屈従 = 800
ELSEIF ABL:Ａ感覚 == 2
	SOURCE:快Ａ = 600
	SOURCE:屈従 = 1400
ELSEIF ABL:Ａ感覚 == 3
	SOURCE:快Ａ = 1000
	SOURCE:屈従 = 1800
ELSEIF ABL:Ａ感覚 == 4
	SOURCE:快Ａ = 1300
	SOURCE:屈従 = 2100
ELSE
	SOURCE:快Ａ = 1700
	SOURCE:屈従 = 2400
ENDIF

;EXP:Ａ経験をみる
IF EXP:Ａ経験 < EXPLV:1
	TIMES SOURCE:快Ａ , 0.50
	SOURCE:痛み = 2000
ELSEIF EXP:Ａ経験 < EXPLV:2
	TIMES SOURCE:快Ａ , 1.00
	SOURCE:痛み = 300
ELSEIF EXP:Ａ経験 < EXPLV:3
	TIMES SOURCE:快Ａ , 1.10
	SOURCE:痛み = 50
ELSEIF EXP:Ａ経験 < EXPLV:4
	TIMES SOURCE:快Ａ , 1.20
	SOURCE:痛み = 10
ELSEIF EXP:Ａ経験 < EXPLV:5
	TIMES SOURCE:快Ａ , 1.40
	SOURCE:痛み = 0
ELSE
	TIMES SOURCE:快Ａ , 1.60
	SOURCE:痛み = 0
ENDIF

;PALAM:潤滑をみる
IF PALAM:潤滑 < PALAMLV:1
	TIMES SOURCE:快Ａ , 0.40
	SOURCE:痛み += 800
ELSEIF PALAM:潤滑 < PALAMLV:2
	TIMES SOURCE:快Ａ , 0.80
	SOURCE:痛み += 500
ELSEIF PALAM:潤滑 < PALAMLV:3
	TIMES SOURCE:快Ａ , 1.00
	SOURCE:痛み += 300
ELSEIF PALAM:潤滑 < PALAMLV:4
	TIMES SOURCE:快Ａ , 1.40
	SOURCE:痛み += 120
ELSE
	TIMES SOURCE:快Ａ , 1.80
	SOURCE:痛み += 100
ENDIF

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES SOURCE:快Ａ , 0.80
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES SOURCE:快Ａ , 0.90
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES SOURCE:快Ａ , 1.00
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES SOURCE:快Ａ , 1.10
ELSE
	TIMES SOURCE:快Ａ , 1.20
ENDIF

;ABL:従順をみる
IF ABL:従順 == 0
	TIMES SOURCE:快Ａ , 0.80
ELSEIF ABL:従順 == 1
	TIMES SOURCE:快Ａ , 0.90
ELSEIF ABL:従順 == 2
	TIMES SOURCE:快Ａ , 1.00
ELSEIF ABL:従順 == 3
	TIMES SOURCE:快Ａ , 1.10
ELSEIF ABL:従順 == 4
	TIMES SOURCE:快Ａ , 1.20
ELSE
	TIMES SOURCE:快Ａ , 1.30
ENDIF

;小柄体型
SIF TALENT:小柄体型
	TIMES SOURCE:痛み , 2.00

;Ａ敏感、鈍感をみる
;快Ａ自体のチェックは後でまとめてやる
IF TALENT:Ａ鈍感
	TIMES SOURCE:痛み , 1.50
	TIMES SOURCE:屈従 , 1.50
	TIMES SOURCE:逸脱 , 1.50
ELSEIF TALENT:Ａ敏感
	TIMES SOURCE:痛み , 0.60
	TIMES SOURCE:屈従 , 0.60
	TIMES SOURCE:逸脱 , 0.60
ENDIF

;処女で貞操観念
IF TALENT:処女 == 1 && TALENT:貞操観念
	SOURCE:屈従 /= 3
ELSEIF TALENT:処女 && TALENT:貞操観念
	SOURCE:屈従 /= 2
ENDIF

;アナル触手の着脱
IF TEQUIP:Ａ系装着器具
	SIF TEQUIP:触手腸内産卵
		CALL KANTYO_EGGPLAY_OUT

	TEQUIP:Ａ系装着器具 = 0
	
	SIF TEQUIP:触手服 & 16
		TEQUIP:触手服 &= 0b1101111
ELSE
	STAIN:アナル |= 2
	STAIN:アナル |= 4
	STAIN:アナル |= 64
	;アナルおねだりの直後ならば効果増強
	IF PREVCOM == 45
		TIMES SOURCE:快Ａ , 1.50
		TIMES SOURCE:屈従 , 2.50
		SOURCE:中毒充足 += 4000
		SIF TALENT:淫尻
			SOURCE:中毒充足 += 4000
	ENDIF

	TEQUIP:Ａ系装着器具 = 1
	
	;触手服への命令として飛んできた場合
	IF !TEQUIP:触手調教 && (TEQUIP:触手服 && !(TEQUIP:触手服 & 16))
		TEQUIP:Ａ系装着器具 = 21
		TEQUIP:触手服 |= 16
	ENDIF
ENDIF

TCVAR:Ａ経験 += 2

;コマンド属性：触手
TFLAG:98 = 8

;触手経験フラグ
TFLAG:90 = 0
RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_502
IF TEQUIP:Ａ系装着器具
	PRINTFORML 触手は%CALLNAME:TARGET%のアヌスから引き抜かれた…
ELSE
	PRINTFORML 長大な触手が%CALLNAME:TARGET%のアナルに潜り込んだ…
	;アナルおねだりの直後で淫尻持ち対象の場合
	SIF PREVCOM == 45 && TALENT:淫尻 && EQUIP:睡眠薬 == 0 && TFLAG:899 == 0
		PRINTFORML %CALLNAME:TARGET%は願い通りお尻を弄ってもらったことに満足そうな\@(TEQUIP:口装着器具) ? 表情を見せ # 喘ぎ声をあげ\@ている……
ENDIF
