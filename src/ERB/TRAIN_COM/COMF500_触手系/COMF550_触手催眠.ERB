;=============================================================================
;触手催眠
;=============================================================================
;口上分岐にTFLAG:99(0=催眠成功、1=催眠失敗)とTFLAG:201(0=催眠開始、1=催眠終了)を使用。もっともTFLAG:201はTEQUIP:触手催眠を見ればいいんだけどね。
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE550
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:550 > 0
	RETURN 0
;紳士的な触手系コマンドを有効にしてないとダメ
SIF (FLAG:15 & 4096) == 0
	RETURN 0
;一度も触手催眠を実行したことが無い場合、異常系調教フィルタがオフになってないとダメ
SIF FLAG:2 & 4 && (CFLAG:24 & 8) == 0
	RETURN 0
;アイテム進化の秘法を持っていないとダメ
SIF ITEM:進化の秘法 == 0
	RETURN 0
;触手調教中じゃないとダメ
SIF TEQUIP:触手調教 == 0; && TEQUIP:触手服 == 0
	RETURN 0
;調教者は触手使役LV4以上必要
SIF ABL:PLAYER:触手使役 < 4
	RETURN 0
;触手が[催眠触手]を得ていないとダメ
SIF (FLAG:75 & 8) == 0
	RETURN 0
;睡眠中は不可
SIF EQUIP:睡眠薬
	RETURN 0
;失神中は不可
SIF TFLAG:899 > 0
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 550) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM550
PRINTL 触手催眠

;戦闘判定
CALL COM_TRY_BATTLE, 550
;実行できない
SIF RESULT == 1
	RETURN 1

TSTR:0 = 触手催眠
TFLAG:99 = 0
IF TEQUIP:触手催眠
	DOWNBASE:0 += 0
	DOWNBASE:1 += 20
	TFLAG:201 = 0 
	CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM
	;触手催眠
	TEQUIP:触手催眠 = 0
	;触手経験フラグ
	TFLAG:90 = 0
	RETURN 1
ENDIF

;催眠成功するかのチェックをするがガードに定評ありの人たち以外はまず失敗しないように
LOCAL:1 = 0
LOCAL:2 = 0

;ABL:調教者の触手使役をみる
IF ABL:PLAYER:触手使役 == 0
	LOCAL:1 = 1
ELSEIF ABL:PLAYER:触手使役 == 1
	LOCAL:1 = 2
ELSEIF ABL:PLAYER:触手使役 == 2
	LOCAL:1 = 3
ELSEIF ABL:PLAYER:触手使役 == 3
	LOCAL:1 = 5
ELSEIF ABL:PLAYER:触手使役 == 4
	LOCAL:1 = 7
ELSE
	LOCAL:1 = 10
ENDIF
;調教者のサド、ドＳ、サドっ気を見る
SIF TALENT:PLAYER:サド || TALENT:PLAYER:ドＳ || ABL:PLAYER:サドっ気 > 2
	LOCAL:1 += 3

;気丈
SIF TALENT:気丈
	LOCAL:2 += 2
;素直
SIF TALENT:素直
	LOCAL:2 -= 1
;自制心
SIF TALENT:自制心
	LOCAL:2 += 5
;無関心
SIF TALENT:無関心
	LOCAL:2 += 2
;感情乏しい
SIF TALENT:感情乏しい
	LOCAL:2 += 1
;好奇心
SIF TALENT:好奇心
	LOCAL:2 -= 2
;抑圧
SIF TALENT:抑圧
	LOCAL:2 += 2
;快感に素直
IF TALENT:快感に素直
	LOCAL:2 -= 2
;快感の否定
ELSEIF TALENT:快感の否定
	LOCAL:2 += 5
ENDIF
;倒錯的
SIF TALENT:倒錯的
	LOCAL:2 -= 2
;中毒しやすい
SIF TALENT:中毒しやすい
	LOCAL:2 -= 2
;幼稚
SIF TALENT:幼稚
	LOCAL:2 -= 5
;淫乱
SIF TALENT:淫乱
	LOCAL:2 -= 2
LOCAL:2 = MAX(LOCAL:2, 0)
IF LOCAL:2
	;PALAM:欲情をみる
	IF PALAM:欲情 < PALAMLV:1
		TIMES LOCAL:2 , 2.20
	ELSEIF PALAM:欲情 < PALAMLV:2
		TIMES LOCAL:2 , 1.70
	ELSEIF PALAM:欲情 < PALAMLV:3
		TIMES LOCAL:2 , 1.30
	ELSEIF PALAM:欲情 < PALAMLV:4
		TIMES LOCAL:2 , 1.00
	ELSE
		TIMES LOCAL:2 , 0.80
	ENDIF
	IF !TALENT:理性 || EQUIP:睡眠薬 || TFLAG:899 >= 1
		TIMES LOCAL:2 , 0.40
	ELSE
	SELECTCASE (BASE:理性 / 120)
		;理性が0以下
		CASE IS <= 0
			TIMES LOCAL:2 , 0.50
		;理性が20未満
		CASE IS < 20
			TIMES LOCAL:2 , 0.60
		;理性が40未満
		CASE IS < 40
			TIMES LOCAL:2 , 0.70
		;理性が60未満
		CASE IS < 60
			TIMES LOCAL:2 , 0.85
		;理性が80未満
		CASE IS < 80
			TIMES LOCAL:2 , 1.00
		;理性が100未満
		CASE IS < 100
			TIMES LOCAL:2 , 1.15
		;理性が100以上
		CASEELSE
			TIMES LOCAL:2 , 1.30
	ENDSELECT
	ENDIF
ENDIF
TFLAG:201 = 1
;TFLAG:99が1ならば催眠失敗、0なら成功
TFLAG:99 = (LOCAL:1 < LOCAL:2 && TALENT:理性) ? 1 # 0
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM
IF TFLAG:99
	DOWNBASE:0 += 20
	DOWNBASE:1 += 150
	SOURCE:中毒充足 = 700
	SOURCE:不潔 = 3000
	SOURCE:逸脱 = 5000
	;触手経験フラグ
	TFLAG:90 = 0
ELSE
	DOWNBASE:0 += 20
	DOWNBASE:1 += 100
	SOURCE:中毒充足 = 700
	SOURCE:不潔 = 3000
	SOURCE:逸脱 = 5000
	TEQUIP:触手催眠 = 1
	;触手経験フラグ
	TFLAG:90 = 1
ENDIF

;コマンド属性：触手
TFLAG:98 = 8
RETURN 1

;--------------------------------------------------
;触手催眠中
;--------------------------------------------------
;TFLAG:201を受け渡し用変数として利用。
@EQUIP_COM550
PRINTL ＜触手催眠中＞

LOCAL:6 = 0
LOCAL:7 = 20

;幾つの条件で判定してランダム要素も加えて今回の催眠のシチュエーションを決める、バランスを破る程度の能力
;いずれの効果も強力だがプレイヤーの計画によってまれに罠に嵌められる事もあります、レズとか好感度とか…
;効果を調整（一部変更）してみた。幻覚内での出来事だから消費体力はやや抑え、気力を大きく
LOCAL = RAND:12
IF (LOCAL == 0 || LOCAL ==1) && EXP:触手経験 < 600
	LOCAL:6 += 100
	LOCAL:7 += 300
	LOCAL:1 = 1 + RAND:10
	LOCAL:5 = 2
	SOURCE:性行動 += 200*LOCAL:1
	SOURCE:屈従 += 100*LOCAL:1
	SOURCE:逸脱 += 10000
	SOURCE:支配 += 100*LOCAL:1

	CALL DISPLAY_KOJO_MESSAGE_SUB_EVENT, TARGET, 8, 4
	CALL DISPLAY_EQUIP_MESSAGE_COM, 550
	IF EXP:Ｖ経験 > 0
		LOCAL:2 = RAND:6
		IF LOCAL:2 > 0
			LOCAL:3 = 1 + ABL:Ｖ感覚
			LOCAL:4 = RAND:4
			TCVAR:Ｖ経験 += LOCAL:2
			SOURCE:快Ｖ += (LOCAL:2 + LOCAL:3)*100
			LOCAL:5 += 1
			IF LOCAL:4 == 0
				LOCAL:4 = 1 + RAND:2
				TCVAR:Ｖ拡張経験 += LOCAL:4
				SOURCE:快Ｖ += (LOCAL:2 + LOCAL:3)*300
				SOURCE:痛み += (LOCAL:2 + LOCAL:3)*350
				LOCAL:5 += 1
			ENDIF
		ENDIF
	ENDIF
	IF EXP:Ａ経験 > 0
		LOCAL:2 = RAND:6
		IF LOCAL:2 > 0
			LOCAL:3 = 1 + ABL:Ａ感覚
			LOCAL:4 = RAND:4
			TCVAR:Ａ経験 += LOCAL:2
			SOURCE:快Ａ += (LOCAL:2 + LOCAL:3)*75
			LOCAL:5 += 1
			IF LOCAL:4 == 0
				LOCAL:4 = 1 + RAND:2
				TCVAR:Ａ拡張経験 += LOCAL:4
				SOURCE:快Ａ += (LOCAL:2 + LOCAL:3)*200
				SOURCE:痛み += (LOCAL:2 + LOCAL:3)*400
				LOCAL:5 += 1
			ENDIF
		ENDIF
	ENDIF
	LOCAL:2 = RAND:6
	IF LOCAL:2 > 0
		LOCAL:3 = 1 + ABL:マゾっ気
		TCVAR:苦痛快楽経験 += LOCAL:2
		TCVAR:緊縛経験 += LOCAL:2
		SOURCE:痛み += (LOCAL:2 + LOCAL:3)*500
		SOURCE:中毒充足 += (LOCAL:2 + LOCAL:3)*400
		SOURCE:逸脱 += (LOCAL:2 + LOCAL:3)*700
		LOCAL:5 += 1
	ENDIF
	LOCAL:2 = RAND:6
	IF LOCAL:2 > 0
		LOCAL:3 = 1 + ABL:Ｃ感覚
		TCVAR:フェラ経験 += LOCAL:2
		SOURCE:性行動 += (LOCAL:2 + LOCAL:3)*500
		SOURCE:達成感 += (LOCAL:2 + LOCAL:3)*400
		LOCAL:3 = 1 + ABL:奉仕精神
		SOURCE:中毒充足 += (LOCAL:2 + LOCAL:3)*300
		SOURCE:屈従 += (LOCAL:2 + LOCAL:3)*400
		LOCAL:5 += 1
	ENDIF
	IF (CFLAG:24 & 8) == 0
		TCVAR:異常経験 += LOCAL:5/2
		CFLAG:24 |= 8
	ENDIF
	;触手経験フラグ
	TFLAG:90 += 14
ELSEIF (LOCAL == 2 || LOCAL == 3) && (TALENT:マゾ || TALENT:男嫌い) && TALENT:オトコ == 0 && EXP:レズ経験 < 1000
	LOCAL:6 += 10
	LOCAL:7 += 50
	LOCAL:1 = 1 + RAND:3
	LOCAL:2 = 1 + ABL:従順
	SOURCE:情愛 += 1000
	SOURCE:快Ｃ += (LOCAL:1 + LOCAL:2) * 100
	SOURCE:液体追加 += LOCAL:1*200
	CALL DISPLAY_KOJO_MESSAGE_SUB_EVENT, TARGET, 8, 1
	TCVAR:レズ経験 += LOCAL:1*10
ELSEIF (LOCAL == 4 || LOCAL == 5) && (TALENT:保守的 || TALENT:抑圧)
	LOCAL:1 = 1 + RAND:3
	LOCAL:7 += 80
	CALL DISPLAY_KOJO_MESSAGE_SUB_EVENT, TARGET, 8, 5
	TFLAG:201 = LOCAL:1
	CALL DISPLAY_EQUIP_MESSAGE_COM, 550
	SOURCE:欲情追加 += 250*LOCAL:1
	SOURCE:露出 += 500*LOCAL:1
	SOURCE:逸脱 += 300*LOCAL:1
ELSEIF (LOCAL == 6 || LOCAL == 7) && CFLAG:好感度 < 2000
	CFLAG:好感度 += 100
	SOURCE:情愛 += 250 + 250*ABL:従順
	CALL DISPLAY_KOJO_MESSAGE_SUB_EVENT, TARGET, 8, 2
	IF TALENT:男嫌い && TALENT:MASTER:オトコ && CFLAG:好感度 >= 1500
		CFLAG:12 |= 4096
		TALENT:男嫌い = 0
		PRINTFORML %CALLNAME:TARGET%は[男嫌い]を失った
	ELSEIF TALENT:女嫌い && TALENT:MASTER:オトコ == 0 && CFLAG:好感度 >= 1500
		CFLAG:12 |= 8192
		TALENT:女嫌い = 0
		PRINTFORML %CALLNAME:TARGET%は[女嫌い]を失った
	ELSEIF TALENT:MASTER:オトコ == 0 && TALENT:オトコ == 0
		TCVAR:レズ経験 += 50
	ELSEIF TALENT:MASTER:オトコ && TALENT:オトコ
		TCVAR:ＢＬ経験 += 50
	ENDIF
ELSEIF MARK:反発刻印 > 0 && LOCAL == 11
	SOURCE:恭順追加 += 500
	CALL DISPLAY_KOJO_MESSAGE_SUB_EVENT, TARGET, 8, 3
	MARK:反発刻印 -= 1
	PRINTFORML %MARKNAME:9%のレベルが{MARK:反発刻印}になりました。
ELSE
	CALL DISPLAY_KOJO_MESSAGE_SUB_EVENT, TARGET, 8, 0
	SOURCE:中毒充足 += 500
	SOURCE:支配 += 200
	TIMES SOURCE:痛み , 0.80
	TIMES SOURCE:痒み , 0.80
	TIMES SOURCE:屈従 , 0.80
ENDIF

TFLAG:201 = LOCAL:1
SIF TFLAG:99 != 4 && TFLAG:99 != 5
	CALL DISPLAY_EQUIP_MESSAGE_COM, 550

;ABL:触手中毒をみる
IF ABL:触手中毒 == 0
	TIMES LOCAL:6 , 1.10
	TIMES LOCAL:7 , 1.10
ELSEIF ABL:触手中毒 == 1
	TIMES LOCAL:6 , 1.00
	TIMES LOCAL:7 , 1.00
ELSEIF ABL:触手中毒 == 2
	TIMES LOCAL:6 , 0.90
	TIMES LOCAL:7 , 0.90
ELSEIF ABL:触手中毒 == 3
	TIMES LOCAL:6 , 0.80
	TIMES LOCAL:7 , 0.80
ELSEIF ABL:触手中毒 == 4
	TIMES LOCAL:6 , 0.70
	TIMES LOCAL:7 , 0.70
ELSE
	TIMES LOCAL:6 , 0.60
	TIMES LOCAL:7 , 0.60
ENDIF

DOWNBASE:0 += LOCAL:6
DOWNBASE:1 += LOCAL:7
;触手経験フラグ
TFLAG:90 += 1
RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_550
;催眠解除(TEQUIP:触手催眠で見るべきかなあ？)
IF TFLAG:201 == 0
	PRINTFORML %CALLNAME:MASTER%は%CALLNAME:TARGET%の目の前で妖しく踊っていた触手を引っ込ませた
	IF ABL:触手中毒 < 2
		PRINTFORML 虚ろな目つきで宙を見つめていた%CALLNAME:TARGET%だったが、しばらくすると正気を取り戻したらしく、%CALLNAME:MASTER%に不信感のこもった視線を向けた…
	ELSE
		PRINTFORML しかし%CALLNAME:TARGET%は触手の魔力にすっかり囚われているようで、術を解いたにもかかわらず未だに幻覚を見ているようだ…
	ENDIF
;催眠開始(TFLAG:99が0なら成功、1なら失敗)
ELSE
	IF TFLAG:99 == 1
		PRINTFORML %CALLNAME:TARGET%に巻き付いていた触手は突如、先端から甘い匂いのするピンク色の煙を吐き出した
		PRINTFORMW 煙を吸いこんだ%CALLNAME:TARGET%は一瞬理性を失いそうになるものの、なんとか正気を保つことに成功した…
		PRINTW           ･
		PRINTW           ･
		PRINTW           ･
		PRINTL 催眠失敗
	ELSE
		PRINTFORML %CALLNAME:TARGET%に巻き付いていた触手は突如、先端から甘い匂いのするピンク色の煙を吐き出した
		PRINTFORML 煙を吸いこんだ%CALLNAME:TARGET%の表情は徐々に虚ろなものになっていく…
		PRINTW           ･
		PRINTW           ･
		PRINTW           ･
		PRINTFORML 抵抗が弱まったのを見計らったのか薄い模様が描かれた触手が数本、%CALLNAME:TARGET%の顔の前にやってきた
		PRINTFORML 触手達は模様から妖しげな光を放ちつつ、まるで踊っているかのように身をくねらせた
		PRINTFORML 踊りを見ていた%CALLNAME:TARGET%は催眠状態に陥り、幻覚を見始めたようだ…
	ENDIF
ENDIF

;--------------------------------------------------
;装着時メッセージ
;--------------------------------------------------
@SYSTXT_EQUIP_MESSAGE_COM_550
SELECTCASE TFLAG:99
	CASE 0
		PRINTFORML %CALLNAME:TARGET%は幻覚の中で何を見ているのか、安らかな笑みを虚空に向けて浮かべている…
	CASE 1
		PRINTFORML %CALLNAME:TARGET%は前から気になっていたあの子と幻覚の中で{TFLAG:201}回レズプレイをしたようだ
		PRINTFORML 現実では触手に犯され、嬲られながらも%CALLNAME:TARGET%はなお、相手の名を叫び続いてる…
	CASE 2
		PRINTFORML %CALLNAME:TARGET%は幻覚の中で%CALLNAME:MASTER%とデートをし、ロマンチックなひと時を過ごした…
		PRINTFORM いつも酷いことをしていた%CALLNAME:MASTER%が急に優しくなり、%CALLNAME:TARGET%は少し戸惑ったが、
		PRINTFORML やがて%CALLNAME:MASTER%の魅力に気づき始めた…
	CASE 3
		PRINTFORML %CALLNAME:TARGET%は虚ろな幻覚を見ながら一部の記憶を書き換えられた
		PRINTFORML %CALLNAME:TARGET%は%CALLNAME:MASTER%に対して強く反発していた事さえも忘れたようだ…
	CASE 4
		PRINTFORML %CALLNAME:TARGET%は幻覚の中の触手達によって通常では思いつきもしないような
		PRINTL 数々の異常極まるプレイを一つ一つ体験させられている…
	CASE 5
		PRINTFORML %CALLNAME:TARGET%は幻覚の中で、大勢の人の前にも拘らず自ら異性を求めて淫らな姿を晒し続けている…
		PRINTFORML 普段の自分にはありえない大胆な行動を何の抵抗もなく次々とこなすことに
		PRINTFORML %CALLNAME:TARGET%は少なからず衝撃を受けたようだ…
ENDSELECT
