;=============================================================================
;触手厄落とし
;=============================================================================
;触手生贄を通じて触手と融合した雛を召喚、
;煽情的な眼差しを向けつつ全身の汚れを舐めとる……という超シャワーでやれなプレイ
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE585
;個別設定コマンドフィルタ
SIF DITEMTYPE:999:585 > 0
	RETURN 0
;紳士的な触手系コマンドを有効にしてないとダメ
SIF (FLAG:15 & 4096) == 0
	RETURN 0
;キャラ専用コマンドを有効にしてないとダメ
SIF (FLAG:15 & 16384) == 0
	RETURN 0
;アイテム進化の秘法を持っていないとダメ
SIF ITEM:進化の秘法 == 0
	RETURN 0
;触手調教中じゃないとダメ
SIF TEQUIP:触手調教 == 0
	RETURN 0
;解除はいつでも可能
SIF TEQUIP:キャラ触手 & 2
	RETURN 1
;調教者は触手使役LV3以上必要
SIF ABL:PLAYER:触手使役 < 3
	RETURN 0
;触手が[HINA触手]を得ていないとダメ
SIF (FLAG:98 & 32) == 0
	RETURN 0
;雛を触手生贄に捧げていない(=雛が何らかの形で存在している)とダメ
SIF (FLAG:97 & 32) == 0
	RETURN 0
;距離のチェック
SIF EQUIP:戦闘中 && COM_ABLE_BATTLE(TARGET, PLAYER, 585) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM585
PRINTL 触手厄落とし

;戦闘判定
CALL COM_TRY_BATTLE, 585
;実行できない
SIF RESULT == 1
	RETURN 1

TSTR:0 = 触手厄落とし
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

DOWNBASE:0 += 5
DOWNBASE:1 += 80

;汚れの計算
LOCAL:23 = 0
LOCAL:21 = 0
LOCAL:22 = 0
REPEAT 8
	;足の汚れは考慮しない
	SIF COUNT == 6
		CONTINUE
	;変数初期化
	LOCAL:COUNT = 0
	;愛液の汚れを計算(ヴァギナは除く)
	SIF STAIN:COUNT & 1 && COUNT != 3
		LOCAL:COUNT += 1
	;ペニスの汚れを計算(ペニスは除く)
	SIF STAIN:COUNT & 2 && COUNT != 2
		LOCAL:COUNT += 1
	;精液の汚れを計算
	IF STAIN:COUNT & 4
		LOCAL:COUNT += 1
		LOCAL:23 += 1
	ENDIF
	;アナルの汚れを計算(アナルは除く)
	SIF STAIN:COUNT & 8 && COUNT != 4
		LOCAL:COUNT += 1
	;母乳の汚れを計算
	SIF STAIN:COUNT & 16
		LOCAL:COUNT += 1
	;破瓜の血の汚れを計算
	SIF STAIN:COUNT & 32
		LOCAL:COUNT += 1
	;粘液の汚れを計算
	SIF STAIN:COUNT & 64
		LOCAL:COUNT += 1
REND

;触手貫通、猿轡無しなら口の汚れをリセット
IF TEQUIP:Ａ系装着器具 != 3 && TEQUIP:口装着器具 == 0
	LOCAL:21 += LOCAL:0 * 50
	STAIN:口 = 0
ENDIF

;手の汚れをリセット
LOCAL:21 += LOCAL:1 * 25
STAIN:手 = 0

;[オトコ]、[ふたなり]を持っていないなら無視
IF EXIST_PENIS(TARGET) == 0
	LOCAL:2 = 0
	STAIN:ペニス = 0
;オナホール、コンドーム([オトコ]の場合は＋カテーテル)無しならペニスの汚れをリセット
ELSEIF TEQUIP:Ｃ系装着器具 == 0 && TEQUIP:コンドーム == 0 && (TALENT:オトコ == 0 || (TEQUIP:Ｕ系装着器具 == 0 && TALENT:オトコ))
	SOURCE:快Ｃ += LOCAL:0 * 40 * (1 + ABL:Ｃ感覚)
	LOCAL:21 += LOCAL:0 * 75 * (1 + ABL:Ｃ感覚)
	STAIN:ペニス = 2
ENDIF

;[オトコ]なら無視
IF TALENT:オトコ
	LOCAL:3 = 0
	STAIN:ヴァギナ = 0
;触手挿入系、クスコ無しならヴァギナの汚れをリセット
ELSEIF TEQUIP:Ｖ系装着器具 == 0 && TEQUIP:クスコ == 0
	SOURCE:快Ｖ += LOCAL:3 * 50 * (1 + ABL:Ｖ感覚)
	LOCAL:21 += LOCAL:3 * 100 * (1 + ABL:Ｖ感覚)
	STAIN:ヴァギナ = 1
ENDIF

;触手アナル挿入系無しならアナルの汚れをリセット
IF TEQUIP:Ｖ系装着器具 == 0
	SOURCE:快Ａ += LOCAL:4 * 60 * (1 + ABL:Ａ感覚)
	LOCAL:21 += LOCAL:4 * 120 * (1 + ABL:Ａ感覚)
	STAIN:アナル = 8
ENDIF

;[オトコ]なら無視
IF TALENT:オトコ
	LOCAL:5 = 0
	STAIN:胸 = 0
;触手乳首責め系無しなら胸の汚れをリセット
ELSEIF TEQUIP:Ｂ系装着器具 == 0
	SOURCE:快Ｂ += LOCAL:5 * 30 * (1 + ABL:Ｂ感覚)
	LOCAL:21 += LOCAL:5 * 50 * (1 + ABL:Ｂ感覚)
	STAIN:胸 = 0
ENDIF

;髪の汚れをリセット
STAIN:髪 = 0

;レズ中毒
SIF ABL:レズ中毒
	TIMES LOCAL:21 , 1.20
;女嫌い
SIF TALENT:恥薄い
	TIMES LOCAL:21 , 0.50

;ABL:精液中毒をみる
IF ABL:精液中毒 == 0
	LOCAL:23 = 0
ELSEIF ABL:精液中毒 == 1
	LOCAL:23 *= 50
ELSEIF ABL:精液中毒 == 2
	LOCAL:23 *= 100
ELSEIF ABL:精液中毒 == 3
	LOCAL:23 *= 200
ELSEIF ABL:精液中毒 == 4
	LOCAL:23 *= 400
ELSE
	LOCAL:23 *= 800
ENDIF

;雛との相性あるなしで補正が上下
LOCAL:20 = 39
IF RELATION:(LOCAL:20) > 0 && RELATION:(LOCAL:20) != 100
	LOCAL:21 *= RELATION:(LOCAL:20)
	LOCAL:21 /= 100
	LOCAL:22 *= RELATION:(LOCAL:20)
	LOCAL:22 /= 100
	LOCAL:23 *= RELATION:(LOCAL:20)
	LOCAL:23 /= 100
ENDIF

SOURCE:液体追加 += LOCAL:22
SOURCE:中毒充足 += (LOCAL:21 + LOCAL:22)/2
SOURCE:不潔 += LOCAL:23
SOURCE:逸脱 += LOCAL:21
REPEAT 8
	SIF COUNT == 6
		CONTINUE
	SOURCE:逸脱 += LOCAL:COUNT * 150
REND

IF TEQUIP:キャラ触手 & 2
	TEQUIP:キャラ触手 -= 2
ELSE
	TEQUIP:キャラ触手 |= 2
ENDIF

;コマンド属性：触手
TFLAG:98 = 8
;触手経験フラグ
TFLAG:90 = 0
RETURN 1

;-------------------------------------------------
;触手汚れ舐め中
;-------------------------------------------------
@EQUIP_COM585
PRINTL ＜触手汚れ舐め中＞

DOWNBASE:0 += 10
DOWNBASE:1 += 40

;汚れの計算
LOCAL:23 = 0
LOCAL:21 = 0
LOCAL:22 = 0
REPEAT 8
	;足の汚れは考慮しない
	SIF COUNT == 6
		CONTINUE
	;変数初期化
	LOCAL:COUNT = 0
	;愛液の汚れを計算(ヴァギナは除く)
	SIF STAIN:COUNT & 1 && COUNT != 3
		LOCAL:COUNT += 1
	;ペニスの汚れを計算(ペニスは除く)
	SIF STAIN:COUNT & 2 && COUNT != 2
		LOCAL:COUNT += 1
	;精液の汚れを計算
	IF STAIN:COUNT & 4
		LOCAL:COUNT += 1
		LOCAL:23 += 1
	ENDIF
	;アナルの汚れを計算(アナルは除く)
	SIF STAIN:COUNT & 8 && COUNT != 4
		LOCAL:COUNT += 1
	;母乳の汚れを計算
	SIF STAIN:COUNT & 16
		LOCAL:COUNT += 1
	;破瓜の血の汚れを計算
	SIF STAIN:COUNT & 32
		LOCAL:COUNT += 1
	;粘液の汚れを計算
	SIF STAIN:COUNT & 64
		LOCAL:COUNT += 1
REND

;触手貫通、猿轡無しなら口の汚れをリセット
IF TEQUIP:Ａ系装着器具 != 3 && TEQUIP:口装着器具 == 0
	LOCAL:21 += LOCAL:0 * 30
	STAIN:口 = 0
ENDIF

;手の汚れをリセット
LOCAL:21 += LOCAL:1 * 10
STAIN:手 = 0

;[オトコ]、[ふたなり]を持っていないなら無視
IF EXIST_PENIS(TARGET) == 0
	LOCAL:2 = 0
	STAIN:ペニス = 0
;オナホール、コンドーム([オトコ]の場合は＋カテーテル)無しならペニスの汚れをリセット
ELSEIF TEQUIP:Ｃ系装着器具 == 0 && TEQUIP:コンドーム == 0 && (TALENT:オトコ == 0 || (TEQUIP:Ｕ系装着器具 == 0 && TALENT:オトコ))
	SOURCE:快Ｃ += LOCAL:0 * 20 * (1 + ABL:Ｃ感覚)
	LOCAL:21 += LOCAL:0 * 50 * (1 + ABL:Ｃ感覚)
	STAIN:ペニス = 2
ENDIF

;[オトコ]なら無視
IF TALENT:オトコ
	LOCAL:3 = 0
	STAIN:ヴァギナ = 0
;触手挿入系、クスコ無しならヴァギナの汚れをリセット
ELSEIF TEQUIP:Ｖ系装着器具 == 0 && TEQUIP:クスコ == 0
	SOURCE:快Ｖ += LOCAL:3 * 25 * (1 + ABL:Ｖ感覚)
	LOCAL:21 += LOCAL:3 * 50 * (1 + ABL:Ｖ感覚)
	STAIN:ヴァギナ = 1
ENDIF

;触手アナル挿入系無しならアナルの汚れをリセット
IF TEQUIP:Ｖ系装着器具 == 0
	SOURCE:快Ａ += LOCAL:4 * 30 * (1 + ABL:Ａ感覚)
	LOCAL:21 += LOCAL:4 * 70 * (1 + ABL:Ａ感覚)
	STAIN:アナル = 8
ENDIF

;[オトコ]なら無視
IF TALENT:オトコ
	LOCAL:5 = 0
	STAIN:胸 = 0
;触手乳首責め系無しなら胸の汚れをリセット
ELSEIF TEQUIP:Ｂ系装着器具 == 0
	SOURCE:快Ｂ += LOCAL:5 * 15 * (1 + ABL:Ｂ感覚)
	LOCAL:21 += LOCAL:5 * 30 * (1 + ABL:Ｂ感覚)
	STAIN:胸 = 0
ENDIF

;髪の汚れをリセット
STAIN:髪 = 0

;レズ中毒
SIF ABL:レズ中毒
	TIMES LOCAL:21 , 1.20
;女嫌い
SIF TALENT:恥薄い
	TIMES LOCAL:21 , 0.50

;ABL:精液中毒をみる
IF ABL:精液中毒 == 0
	LOCAL:23 = 0
ELSEIF ABL:精液中毒 == 1
	LOCAL:23 *= 20
ELSEIF ABL:精液中毒 == 2
	LOCAL:23 *= 50
ELSEIF ABL:精液中毒 == 3
	LOCAL:23 *= 75
ELSEIF ABL:精液中毒 == 4
	LOCAL:23 *= 100
ELSE
	LOCAL:23 *= 200
ENDIF

;雛との相性あるなしで補正が上下
LOCAL:20 = 39
IF RELATION:(LOCAL:20) > 0 && RELATION:(LOCAL:20) != 100
	LOCAL:21 *= RELATION:(LOCAL:20)
	LOCAL:21 /= 100
	LOCAL:22 *= RELATION:(LOCAL:20)
	LOCAL:22 /= 100
	LOCAL:23 *= RELATION:(LOCAL:20)
	LOCAL:23 /= 100
ENDIF

SOURCE:液体追加 += LOCAL:22
SOURCE:中毒充足 += (LOCAL:21 + LOCAL:22)/2
SOURCE:不潔 += LOCAL:23
SOURCE:逸脱 += LOCAL:21
REPEAT 8
	SIF COUNT == 6
		CONTINUE
	SOURCE:逸脱 += LOCAL:COUNT * 50
REND

;雛の性別上、調教対象が♀の時のみレズ経験が入る仕様に
SIF TALENT:オトコ == 0
	TCVAR:レズ経験 += 1

;触手経験フラグ
TFLAG:90 += 1
RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_585
IF TEQUIP:キャラ触手 & 2
	PRINTFORML %CALLNAME:PLAYER%の命令を受け、雛は%CALLNAME:TARGET%の裸体から身を離した
	PRINTFORML そして全身が唾液でべっとりと濡れている%CALLNAME:TARGET%をその場に残すと、雛は触手の管に籠り、何処かへと去って行った……
ELSE
	PRINTFORML %CALLNAME:PLAYER%は命令を下すと、毒々しい色をした巨大な触手が肉の壁をかき分けて現れた
	PRINTFORML 触手は%CALLNAME:TARGET%の目の前に来ると腐った果実のように外側が溶け落ちた
	PRINTL 腐臭漂う中、白い裸体の下半分を肉の管に埋めさせた状態で、髪の毛に付いた溶けた肉の破片を払い落しながら雛が姿を現した
	PRINTFORML 雛は%CALLNAME:MASTER%に軽く目を閉じてお辞儀をすると、濁った瞳を%CALLNAME:TARGET%に向けた
	PRINTFORML そしておもむろに%CALLNAME:TARGET%に近づくと、雛は全身に付いた汚れをその小さな舌で舐め始めた…
	PRINTFORML 雛は汚れを舐めとる度に熱い鼻息が%CALLNAME:TARGET%の裸身に吹きかかっていく
	SIF EQUIP:睡眠薬 == 0 && TFLAG:899 == 0
		PRINTFORML その心地良いくすぐったさとぴちゃぴちゃと響く卑猥な音に%CALLNAME:TARGET%の心は翻弄されていく……
ENDIF
