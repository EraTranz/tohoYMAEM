;=============================================================================
;★拘束
;=============================================================================
;--------------------------------------------------
;実行判定
;--------------------------------------------------
@COM_ABLE760
;個別設定コマンドフィルタ
;SIF DITEMTYPE:999:760 > 0
;	RETURN 0
;助手は技巧4でないとダメ
IF ASSIPLAY
	SIF ABL:ASSI:技巧 < 4
		RETURN 0
;調教者の技巧が2無いとできない
ELSE
	SIF ABL:PLAYER:技巧 < 2
		RETURN 0
ENDIF
;拘束中はダメ＋★拘束中じゃないとダメ
SIF TEQUIP:緊縛関連 && (TEQUIP:緊縛関連 != 8 || TEQUIP:緊縛関連 != TEQUIP:PLAYER:緊縛関連)
	RETURN 0
;戦闘中じゃないとダメ
SIF !EQUIP:戦闘中
	RETURN 0
;距離のチェック
SIF COM_ABLE_BATTLE(TARGET, PLAYER, 760) == 0
	RETURN 0
RETURN 1

;--------------------------------------------------
;コマンド本体
;--------------------------------------------------
@COM760
IF TEQUIP:緊縛関連
	PRINTL 拘束を解く

	;戦闘判定
	CALL COM_TRY_BATTLE, 760
	;実行できない
	SIF RESULT == 1
		RETURN 1

	TSTR:0 = 拘束を解く
ELSE
	PRINTL 拘束

	;戦闘判定
	CALL COM_TRY_BATTLE, 760
	;実行できない
	SIF RESULT == 1
		RETURN 1

	TSTR:0 = 拘束
ENDIF
CALL DISPLAY_KOJO_TRAIN_MESSAGE_F_COM

DOWNBASE:0 += 70
DOWNBASE:1 += 120

LOCAL:1 = 100
LOCAL:2 = 100

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL:1 , 1.00
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL:1 , 1.10
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL:1 , 1.20
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL:1 , 1.30
ELSE
	TIMES LOCAL:1 , 1.40
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES LOCAL:1 , 1.00
ELSEIF ABL:マゾっ気 == 1
	TIMES LOCAL:1 , 1.20
ELSEIF ABL:マゾっ気 == 2
	TIMES LOCAL:1 , 1.40
ELSEIF ABL:マゾっ気 == 3
	TIMES LOCAL:1 , 1.60
ELSEIF ABL:マゾっ気 == 4
	TIMES LOCAL:1 , 1.80
ELSE
	TIMES LOCAL:1 , 2.00
ENDIF

;ABL:従順をみる
IF ABL:従順 == 0
	TIMES LOCAL:2 , 1.40
ELSEIF ABL:従順 == 1
	TIMES LOCAL:2 , 1.20
ELSEIF ABL:従順 == 2
	TIMES LOCAL:2 , 1.10
ELSEIF ABL:従順 == 3
	TIMES LOCAL:2 , 1.00
ELSEIF ABL:従順 == 4
	TIMES LOCAL:2 , 0.90
ELSE
	TIMES LOCAL:2 , 0.80
ENDIF

;接触
SOURCE:接触 = LOCAL:1 * 4
;露出
SOURCE:露出 = LOCAL:1
;痛み
SOURCE:痛み = LOCAL:2 * 2
;屈従
SOURCE:屈従 = LOCAL:2 * 5
;逸脱
SOURCE:逸脱 = LOCAL:2 * 6

;拘束を解く
IF TEQUIP:緊縛関連
	TEQUIP:緊縛関連 = 0
	TEQUIP:PLAYER:緊縛関連 = 0
ELSE
	TEQUIP:緊縛関連 = 8
	TEQUIP:PLAYER:緊縛関連 = 8
	距離:PLAYER = 距離:TARGET
ENDIF

RETURN 1

;-------------------------------------------------
;拘束中
;-------------------------------------------------
@EQUIP_COM760
PRINTL ＜拘束中＞

IF TEQUIP:緊縛関連 == 9
	DOWNBASE:0 += 20
	DOWNBASE:1 += 40
	LOCAL:1 = 40
	LOCAL:2 = 40
ELSE
	DOWNBASE:0 += 30
	DOWNBASE:1 += 60
	LOCAL:1 = 60
	LOCAL:2 = 60
ENDIF

;PALAM:欲情をみる
IF PALAM:欲情 < PALAMLV:1
	TIMES LOCAL:1 , 1.00
ELSEIF PALAM:欲情 < PALAMLV:2
	TIMES LOCAL:1 , 1.10
ELSEIF PALAM:欲情 < PALAMLV:3
	TIMES LOCAL:1 , 1.20
ELSEIF PALAM:欲情 < PALAMLV:4
	TIMES LOCAL:1 , 1.30
ELSE
	TIMES LOCAL:1 , 1.40
ENDIF

;ABL:マゾっ気をみる
IF ABL:マゾっ気 == 0
	TIMES LOCAL:1 , 1.00
ELSEIF ABL:マゾっ気 == 1
	TIMES LOCAL:1 , 1.20
ELSEIF ABL:マゾっ気 == 2
	TIMES LOCAL:1 , 1.40
ELSEIF ABL:マゾっ気 == 3
	TIMES LOCAL:1 , 1.60
ELSEIF ABL:マゾっ気 == 4
	TIMES LOCAL:1 , 1.80
ELSE
	TIMES LOCAL:1 , 2.00
ENDIF

;ABL:従順をみる
IF ABL:従順 == 0
	TIMES LOCAL:2 , 1.40
ELSEIF ABL:従順 == 1
	TIMES LOCAL:2 , 1.20
ELSEIF ABL:従順 == 2
	TIMES LOCAL:2 , 1.10
ELSEIF ABL:従順 == 3
	TIMES LOCAL:2 , 1.00
ELSEIF ABL:従順 == 4
	TIMES LOCAL:2 , 0.90
ELSE
	TIMES LOCAL:2 , 0.80
ENDIF

;接触
SOURCE:接触 += LOCAL:1 * 4
;露出
SOURCE:露出 += LOCAL:1
;痛み
SOURCE:痛み += LOCAL:2 * 2
;屈従
SOURCE:屈従 += LOCAL:2 * 5
;逸脱
SOURCE:逸脱 += LOCAL:2 * 6

IF TALENT:オトコ == 0 && TALENT:PLAYER:オトコ == 0
	TCVAR:レズ経験 += 1
ELSEIF TALENT:オトコ && TALENT:PLAYER:オトコ
	TCVAR:ＢＬ経験 += 1
ENDIF
;主人経験フラグ
SIF ASSIPLAY == 0 && ABL:マゾっ気 >= 2
	TFLAG:50 += 1

RETURN 1

;--------------------------------------------------
;調教時メッセージ
;--------------------------------------------------
@SYSTXT_TRAIN_MESSAGE_F_COM_760
IF TEQUIP:緊縛関連 == 8
	SELECTCASE RAND:2
	CASE 0
		PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%をそっと開放した…
	CASE 1
		PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%をそっと離した…
	ENDSELECT
ELSE
	SELECTCASE RAND:3
	CASE 0
		IF COMMON_BODYSIZE_CHECK2(PLAYER, TARGET) <= 0
			PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%の背後に回り込んで、羽交い締めにした…
		ELSE
			PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%の背後に回り込んで拘束した…
		ENDIF
	CASE 1
		IF COMMON_BODYSIZE_CHECK2(PLAYER, TARGET) <= -1
			PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%の両手を片手で押さえて拘束した…
		ELSEIF COMMON_BODYSIZE_CHECK2(PLAYER, TARGET) == 0
			PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%を押し倒し、覆いかぶさるように乗り掛かった…
		ELSE
			PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%を押し倒した…
		ENDIF
	CASE 2
		IF COMMON_BODYSIZE_CHECK2(PLAYER, TARGET) <= 0
			PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%の身を、取り込むように抱きしめた…
		ELSE
			PRINTFORML %CALLNAME:PLAYER%は%CALLNAME:TARGET%を抱きしめた…
		ENDIF
	ENDSELECT
ENDIF
