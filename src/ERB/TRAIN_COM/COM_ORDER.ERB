;-------------------------------------------------
;コマンドを実行できるか判定の処理
;-------------------------------------------------
;各コマンドの実行判定もこちらへ移植しました
;通常の呼び出し以外に引数を持たせることができる。
;引数1にコマンド番号を入れると、指定したコマンドの実行判定を行う（省略するとSELECTCOM）
;引数2に1を入れると、判定結果を表示しない（省略すると表示する）
;引数3に1以上を入れた場合は、イベント口上と拒否の地の文を呼ばない（省略すると呼ぶ）が引数2で表示するときのみ有効
;いずれの場合もRESULT=1で実行可、=0で不可
;TFLAG:240 (旧A) = 基準値 
;TFLAG:241 (旧V) = 実行値 
;-------------------------------------------------
@COM_ORDER, ARG, ARG:1, ARG:2
SIF ARG <= 0
	ARG = SELECTCOM

TFLAG:240 = 0
LOCAL:99 = 0
RESULTS = 

;ABL:従順
IF ABL:従順
	LOCAL:99 = ABL:従順
	TFLAG:240 += LOCAL:99 * 4
	RESULTS = %RESULTS% %ABLNAME:10%LV{LOCAL:99}({LOCAL:99 * 4})
ENDIF
;ABL:サドっ気
IF ABL:サドっ気
	SIF LOCAL:99
		RESULTS = %RESULTS% - 
	LOCAL:99 = ABL:サドっ気
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %ABLNAME:20%LV{LOCAL:99}({LOCAL:99})
ENDIF
;ABL:マゾっ気
IF ABL:マゾっ気
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = ABL:マゾっ気
	TFLAG:240 += LOCAL:99 * 2
	RESULTS = %RESULTS% %ABLNAME:21%LV{LOCAL:99}({LOCAL:99 * 2})
ENDIF

;ＢＬ調教・レズ調教
IF (TALENT:PLAYER:オトコ && TALENT:オトコ) || (TALENT:PLAYER:オトコ == 0 && TALENT:オトコ == 0)
	;ABL:レズっ気・ＢＬっ気
	LOCAL = 22 + TALENT:オトコ
	IF ABL:LOCAL
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = ABL:LOCAL
		TFLAG:240 += LOCAL:99 * 3
		RESULTS = %RESULTS% %ABLNAME:LOCAL%LV{LOCAL:99}({LOCAL:99 * 3})
	ENDIF
	;ABL:レズ中毒・ＢＬ中毒
	LOCAL = 32 + TALENT:オトコ
	IF ABL:LOCAL
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = ABL:LOCAL
		TFLAG:240 += LOCAL:99 * 3
		RESULTS = %RESULTS% %ABLNAME:LOCAL%LV{LOCAL:99}({LOCAL:99 * 3})
	ENDIF
	;TALENT:両刀
	IF TALENT:両刀
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 10
		TFLAG:240 += LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:83%({LOCAL:99})
	ENDIF
	;好奇心
	IF TALENT:好奇心
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 8
		TFLAG:240 += LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:23%({LOCAL:99})
	ENDIF
	;保守的
	IF TALENT:保守的
		RESULTS = %RESULTS% - 
		LOCAL:99 = 15
		TFLAG:240 -= LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:24%({LOCAL:99})
	ENDIF
ELSE
	;好奇心
	IF TALENT:好奇心
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 5
		TFLAG:240 += LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:23%({LOCAL:99})
	ENDIF
	;保守的
	IF TALENT:保守的
		RESULTS = %RESULTS% - 
		LOCAL:99 = 10
		TFLAG:240 -= LOCAL:99
		RESULTS = %RESULTS% %TALENTNAME:24%({LOCAL:99})
	ENDIF
ENDIF

;刻印チェック
;苦痛刻印
IF MARK:苦痛刻印
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:苦痛刻印
	TFLAG:240 += LOCAL:99 * 5
	RESULTS = %RESULTS% %MARKNAME:0%LV{LOCAL:99}({LOCAL:99 * 5})
ENDIF
;屈服刻印
IF TALENT:プライド高い
	LOCAL:1 = 4
ELSEIF TALENT:プライド低い
	LOCAL:1 = 1
ELSE
	LOCAL:1 = 2
ENDIF
IF MARK:屈服刻印
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:屈服刻印
	TFLAG:240 += LOCAL:99 * 3 * LOCAL:1
	RESULTS = %RESULTS% %MARKNAME:2%LV{LOCAL:99}({LOCAL:99 * 3 * LOCAL:1})
ENDIF
;薬物刻印
IF MARK:薬物刻印
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:薬物刻印
	TFLAG:240 += LOCAL:99 * LOCAL:99
	RESULTS = %RESULTS% %MARKNAME:3%LV{LOCAL:99}({LOCAL:99 * LOCAL:99})
ENDIF
;恥辱刻印
IF MARK:恥辱刻印
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:恥辱刻印
	TFLAG:240 += LOCAL:99 * 2
	RESULTS = %RESULTS% %MARKNAME:4%LV{LOCAL:99}({LOCAL:99 * 2})
ENDIF
;恐怖刻印
IF TALENT:臆病
	LOCAL:1 = 4
ELSEIF TALENT:気丈
	LOCAL:1 = 1
ELSE
	LOCAL:1 = 2
ENDIF
IF MARK:恐怖刻印
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = MARK:恐怖刻印
	TFLAG:240 += LOCAL:99 * 3 * LOCAL:1
	RESULTS = %RESULTS% %MARKNAME:8%LV{LOCAL:99}({LOCAL:99 * 3 * LOCAL:1})
ENDIF
;反発刻印
IF MARK:反発刻印
	RESULTS = %RESULTS% - 
	LOCAL:99 = MARK:反発刻印
	TFLAG:240 -= LOCAL:99 * 2 * LOCAL:1
	RESULTS = %RESULTS% %MARKNAME:9%LV{LOCAL:99}({LOCAL:99 * 2 * LOCAL:1})
ENDIF

;PALAM:恭順
GETPALAMLV PALAM:恭順, 5
LOCAL:2 = RESULT
IF LOCAL:2
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = LOCAL:2 * 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %PALAMNAME:12%LV{LOCAL:2}({LOCAL:99})
ENDIF
;PALAM:恐怖
GETPALAMLV PALAM:恐怖, 5
LOCAL:2 = RESULT
IF LOCAL:2
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = LOCAL:2 * 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %PALAMNAME:17%LV{LOCAL:2}({LOCAL:99})
ENDIF

;反抗的
IF TALENT:反抗的
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:11%({LOCAL:99})
ENDIF
;気丈
IF TALENT:気丈
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:12%({LOCAL:99})
ENDIF
;素直
IF TALENT:素直
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:13%({LOCAL:99})
ENDIF
;プライド高い
IF TALENT:プライド高い
	RESULTS = %RESULTS% - 
	LOCAL:99 = 15
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:16%({LOCAL:99})
;プライド低い
ELSEIF TALENT:プライド低い
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:17%({LOCAL:99})
ENDIF
;目立ちたがり
IF TALENT:目立ちたがり
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 2
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:28%({LOCAL:99})
ENDIF
;抑圧
IF TALENT:抑圧
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:32%({LOCAL:99})
ENDIF
;抵抗
IF TALENT:抵抗
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:34%({LOCAL:99})
ENDIF
;弱味
IF TALENT:弱味
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 12
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:39%({LOCAL:99})
ENDIF
;[半白澤](変身中)
IF TALENT:半白澤 == 2
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:212%({LOCAL:99})
ENDIF
;鬼(陥落していない)
IF TALENT:鬼 && (TALENT:恋慕 + TALENT:妄信 + TALENT:親愛 + TALENT:相愛 + TALENT:服従 + TALENT:烙印 + TALENT:隷属 + TALENT:使い魔 + TALENT:精神崩壊 + TALENT:傀儡 + TALENT:壊造人格) == 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:214%({LOCAL:99})
;天狗(調教者が[鬼])
ELSEIF TALENT:天狗 && TALENT:PLAYER:鬼
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:215%({LOCAL:99})
;天狗(陥落していない)
ELSEIF TALENT:天狗 && (TALENT:恋慕 + TALENT:妄信 + TALENT:親愛 + TALENT:相愛 + TALENT:服従 + TALENT:烙印 + TALENT:隷属 + TALENT:使い魔 + TALENT:精神崩壊 + TALENT:傀儡 + TALENT:壊造人格) == 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:215%({LOCAL:99})
ENDIF
;仙人(調教者が[死神])
IF TALENT:仙人 && TALENT:PLAYER:死神
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:225%({LOCAL:99})
;死神(調教者が[仙人])
ELSEIF TALENT:死神 && TALENT:PLAYER:仙人
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:224%({LOCAL:99})
ENDIF
;妄信
IF TALENT:妄信
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:151%({LOCAL:99})
ENDIF
;服従
IF TALENT:服従
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:160%({LOCAL:99})
ENDIF
;烙印
IF TALENT:烙印
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:161%({LOCAL:99})
ENDIF
;隷属
IF TALENT:隷属
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:162%({LOCAL:99})
ENDIF
;傷物
IF TALENT:傷物
	SIF LOCAL:99
		RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:163%({LOCAL:99})
ENDIF
;使い魔
IF TALENT:使い魔
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:164%({LOCAL:99})
ENDIF
;精神崩壊
;心が壊れ、何をするのか理解・認識しにくくなったため
IF TALENT:精神崩壊
	SIF LOCAL:99
		RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:167%({LOCAL:99})
ENDIF
;傀儡
;ロボット化によりコマンド拒否不可能
IF TALENT:傀儡
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:168%({LOCAL:99})
ENDIF
;壊造人格
;人格を破壊された揚句、都合のいいもの上書きされているのでコマンド拒否不可能
IF TALENT:壊造人格
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:169%({LOCAL:99})
ENDIF
;淫乱
IF TALENT:淫乱
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:170%({LOCAL:99})
ENDIF
;即落ち
IF TALENT:即落ち
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:179%({LOCAL:99})
ENDIF

;発情
IF TALENT:常時発情
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %TALENTNAME:501%({LOCAL:99})
ELSEIF TALENT:危険日 && TALENT:発情可
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 発情中({LOCAL:99})
ENDIF

;時止め中
;当然コマンド拒否不可能
IF TEQUIP:時間止め
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 時止め中({LOCAL:99})
ENDIF
;死亡
;当然コマンド拒否不可能
IF TALENT:死亡
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 死亡({LOCAL:99})
ENDIF
;睡眠状態
;当然コマンド拒否不可能
IF EQUIP:睡眠薬
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 睡眠中({LOCAL:99})
ENDIF
;失神状態
;当然コマンド拒否不可能
IF TFLAG:899
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 999
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 失神中({LOCAL:99})
ENDIF

;蜘蛛の巣で拘束
;抵抗しにくくなるため
IF TEQUIP:緊縛関連 == 7
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 蜘蛛の巣で拘束({LOCAL:99})
ENDIF
;操りの糸
IF TEQUIP:精神制御系
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 魔法の糸で操られている({LOCAL:99})
ENDIF
;催眠状態
IF TEQUIP:触手催眠
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 催眠状態({LOCAL:99})
ENDIF
;お香の効果(ジャスミン・フランキンセンス)
;なお、野外プレイ・お風呂場プレイ・特殊風呂プレイ中は効果を発揮しない
IF (TEQUIP:89 == 3 || TEQUIP:89 == 6) && TEQUIP:野外プレイ == 0 && TEQUIP:お風呂場プレイ == 0 && TEQUIP:特殊風呂入浴中 == 0
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS%お香による効果({LOCAL:99})
ENDIF
;狂気の目発動中
IF TFLAG:152
	RESULTS = %RESULTS% - 
	LOCAL:99 = 15
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 狂気の目防衛中({LOCAL:99})
ENDIF
;理性ある
IF TALENT:理性 && BASE:理性 > 0 && MAXBASE:9 > 0
	LOCAL:99 = BASE:理性 / 1200 - 5
	TFLAG:240 -= LOCAL:99
	IF LOCAL:99 != 0
		IF LOCAL:99 > 0
			RESULTS = %RESULTS% - 
		ELSE
			RESULTS = %RESULTS% + 
			LOCAL:99 *= -1
		ENDIF
		RESULTS = %RESULTS% 理性({LOCAL:99})
	ENDIF
ELSE
	RESULTS = %RESULTS% + 
	LOCAL:99 = 6
	IF TALENT:理性
		LOCAL:99 = 6
	ELSE
		LOCAL:99 = 8
	ENDIF
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 無理性({LOCAL:99})
ENDIF

;CFLAG:調教度
IF CFLAG:3668 != 0
	IF CFLAG:3668 >= 900
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 5
		TFLAG:240 += LOCAL:99
	ELSEIF CFLAG:3668 >= 600
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 3
		TFLAG:240 += LOCAL:99
	ELSEIF CFLAG:3668 >= 300
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 1
		TFLAG:240 += LOCAL:99
	ELSEIF CFLAG:3668 >= 0
		RESULTS = %RESULTS% -
		LOCAL:99 = 1
		TFLAG:240 -= LOCAL:99
	ELSEIF CFLAG:3668 >= -300
		RESULTS = %RESULTS% - 
		LOCAL:99 = 3
		TFLAG:240 -= LOCAL:99
	ELSEIF CFLAG:3668 >= -600
		RESULTS = %RESULTS% - 
		LOCAL:99 = 5
		TFLAG:240 -= LOCAL:99
	ELSEIF CFLAG:3668 >= -900
		RESULTS = %RESULTS% - 
		LOCAL:99 = 7
		TFLAG:240 -= LOCAL:99
	ELSE
		RESULTS = %RESULTS% - 
		LOCAL:99 = 9
		TFLAG:240 -= LOCAL:99
	ENDIF
	RESULTS = %RESULTS% 調教度({LOCAL:99})
ENDIF

;奴隷が体力切れ
IF BASE:体力 <= 500
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:TARGET%が体力切れ({LOCAL:99})
ENDIF
;奴隷が気力切れ
IF BASE:気力 <= 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:TARGET%が気力切れ({LOCAL:99})
ENDIF

;調教者の素質
;臆病
IF TALENT:PLAYER:臆病
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:10%({LOCAL:99})
ENDIF
;男嫌い
IF TALENT:PLAYER:男嫌い && TALENT:オトコ
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:37%({LOCAL:99})
;女嫌い
ELSEIF TALENT:PLAYER:女嫌い && TALENT:オトコ == 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 12
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:38%({LOCAL:99})
ENDIF
;サド
IF TALENT:PLAYER:サド
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:81%({LOCAL:99})
ENDIF
;魅惑
IF TALENT:PLAYER:魅惑
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:91%({LOCAL:99})
ENDIF
;謎の魅力
IF TALENT:PLAYER:謎の魅力
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:92%({LOCAL:99})
ENDIF
;小悪魔
IF TALENT:PLAYER:小悪魔
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = (TALENT:PLAYER:幼児 || TALENT:PLAYER:幼稚 || TALENT:PLAYER:幼児退行) ? 8 # 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:93%({LOCAL:99})
ENDIF
;大乳導
IF TALENT:PLAYER:大乳導 && (TALENT:巨乳 || TALENT:爆乳)
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:96%({LOCAL:99})
;つるぺた堕し
ELSEIF TALENT:PLAYER:つるぺた堕し && (TALENT:絶壁 || TALENT:貧乳)
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 8
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:97%({LOCAL:99})
ENDIF
;[半白澤](変身中)
IF TALENT:PLAYER:半白澤 == 2
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 4
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:212%({LOCAL:99})
ENDIF
;調教者が気力切れ
IF BASE:PLAYER:気力 <= 0
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が気力切れ({LOCAL:99})
ENDIF

;助手の素質
;嫉妬しやすい
IF ASSIPLAY && TALENT:PLAYER:嫉妬しやすい
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:19%({LOCAL:99})
ENDIF
;鼓舞
IF ASSIPLAY && TALENT:PLAYER:鼓舞
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 1
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% %CALLNAME:PLAYER%が%TALENTNAME:95%({LOCAL:99})
ENDIF

;相性チェック(相性普通のときは表示しなくした)
LOCAL:3 = TRAIN_RELATION_CALC(PLAYER)
IF LOCAL:3 == 0 || LOCAL:3 == 100
;	SIF LOCAL:99
;		RESULTS = %RESULTS% + 
;	RESULTS = %RESULTS% 相性普通(0)
ELSEIF LOCAL:3 < 30
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 相性最悪({LOCAL:99})
ELSEIF LOCAL:3 < 70
	RESULTS = %RESULTS% - 
	LOCAL:99 = 6
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 相性悪い({LOCAL:99})
ELSEIF LOCAL:3 < 100
	RESULTS = %RESULTS% - 
	LOCAL:99 = 3
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% 相性いまいち({LOCAL:99})
ELSEIF LOCAL:3 < 130
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 3
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 相性ややよい({LOCAL:99})
ELSEIF LOCAL:3 < 170
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 6
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 相性よい({LOCAL:99})
ELSE
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% 相性最高({LOCAL:99})
ENDIF

;難易度(PHANTASMなら-20、LUNATICなら-10、HARDなら-5、EASYなら+5実行判定に加える)
IF FLAG:3 == 7
	RESULTS = %RESULTS% - 
	LOCAL:99 = 20
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% OVERDRIVE({LOCAL:99})
ELSEIF FLAG:3 == 6
	RESULTS = %RESULTS% - 
	LOCAL:99 = 15
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% ULTRA({LOCAL:99})
ELSEIF FLAG:3 == 5
	RESULTS = %RESULTS% - 
	LOCAL:99 = 20
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% PHANTASM({LOCAL:99})
ELSEIF FLAG:3 == 4
	RESULTS = %RESULTS% - 
	LOCAL:99 = 10
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% LUNATIC({LOCAL:99})
ELSEIF FLAG:3 == 3
	RESULTS = %RESULTS% - 
	LOCAL:99 = 5
	TFLAG:240 -= LOCAL:99
	RESULTS = %RESULTS% HARD({LOCAL:99})
ELSEIF FLAG:3 == 2
;	SIF LOCAL:99
;		RESULTS = %RESULTS% + 
;	LOCAL:99 = 0
;	TFLAG:240 += LOCAL:99
;	RESULTS = %RESULTS% NORMAL({LOCAL:99})
;	LOCAL:99 = 1
ELSEIF FLAG:3 == 1
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 5
	TFLAG:240 += LOCAL:99
	RESULTS = %RESULTS% EASY({LOCAL:99})
ENDIF

;YASAI
IF TALENT:PLAYER:野菜の錬金術師 && TEQUIP:YASAIモードで使用
	SIF LOCAL:99
		RESULTS = %RESULTS% + 
	LOCAL:99 = 10
	TFLAG:240 += LOCAL:99
	IF TEQUIP:YASAIモードで使用 == 2
		RESULTS = %RESULTS% Phモード({LOCAL:99})
	ELSEIF TEQUIP:YASAIモードで使用 == 1
		RESULTS = %RESULTS% Exモード({LOCAL:99})
	ENDIF
ENDIF
;Debug
IF TALENT:MASTER:998 && TEQUIP:0
	IF TEQUIP:0 == 1
		SIF LOCAL:99
			RESULTS = %RESULTS% + 
		LOCAL:99 = 999
		TFLAG:240 += LOCAL:99
	ELSE
		RESULTS = %RESULTS% - 
		LOCAL:99 = 999
		TFLAG:240 -= LOCAL:99
	ENDIF
	RESULTS = %RESULTS% デバッグモード({LOCAL:99})
ENDIF

LOCAL = 0
TRYCALLFORM COM_ORDER_{ARG}, LOCAL:99
RESULTS = %RESULTS% = \@(TFLAG:240 < 0) ? - # \@\@(ABS(TFLAG:240) > 99) ? XX # {ABS(TFLAG:240)}\@
IF TFLAG:240 < TFLAG:241
	LOCAL = 0
	RESULTS = %RESULTS% < 
ELSEIF TFLAG:240 == TFLAG:241
	LOCAL = 1
	RESULTS = %RESULTS% = 
ELSE
	LOCAL = 1
	RESULTS = %RESULTS% > 
ENDIF

IF ARG:1 <= 0
	IF LOCAL == 1
		PRINTFORMW %RESULTS% 実行値{TFLAG:241} 『成功』
	ELSE
		PRINTFORMW %RESULTS% 実行値{TFLAG:241} 『失敗』
	ENDIF

	;拒否されたときの地の文・口上
	IF LOCAL == 0 && ARG:2 < 1
		CALL DISPLAY_KOJO_DENIAL_MESSAGE_COM, ARG
		;コマンドを実行できなかったときのパラ変動処理
		CALL DENIAL_PALAM_MOVE
		;-------------------------------------------------
		;コマンド終了時の調教の成果表示処理
		;-------------------------------------------------
		TFLAG:97 = 0
		TFLAG:550 = 0
		;各経験値の入手、パラメータの変動もここで行う
		CALL SHOW_TRAIN_RESULT_PLAYER, MASTER
		SIF ASSI >= 0
			CALL SHOW_TRAIN_RESULT_PLAYER, ASSI
		CALL SHOW_TRAIN_RESULT_SLAVE
		WAIT
	ENDIF
ENDIF

RETURN LOCAL

;-------------------------------------------------
;コマンドを実行できなかったときのパラ変動処理
;-------------------------------------------------
@DENIAL_PALAM_MOVE

;失敗
IF EQUIP:戦闘中
	LOCAL = (TFLAG:241 - TFLAG:240) * 150
	;ファンブル
	SIF TFLAG:552 > 1
		TIMES LOCAL , 2.00
ELSE
	LOCAL = (TFLAG:241 - TFLAG:240) * 40
ENDIF

;難易度をみる
IF FLAG:3 == 1
	TIMES LOCAL , 0.50
ELSEIF FLAG:3 == 2
	TIMES LOCAL , 1.00
ELSEIF FLAG:3 == 3
	TIMES LOCAL , 1.20
ELSEIF FLAG:3 == 4
	TIMES LOCAL , 1.40
ELSEIF FLAG:3 == 6
	TIMES LOCAL , 1.60
ELSE
	TIMES LOCAL , 1.80
ENDIF

;MARK:反発刻印
IF MARK:反発刻印 == 0
	TIMES LOCAL , 0.75
ELSEIF MARK:反発刻印 == 1
	TIMES LOCAL , 1.00
ELSEIF MARK:反発刻印 == 2
	TIMES LOCAL , 1.25
ELSE
	TIMES LOCAL , 1.50
ENDIF

;MARK:恐怖刻印
IF MARK:恐怖刻印 == 0
	TIMES LOCAL , 0.75
ELSEIF MARK:恐怖刻印 == 1
	TIMES LOCAL , 1.00
ELSEIF MARK:恐怖刻印 == 2
	TIMES LOCAL , 1.25
ELSE
	TIMES LOCAL , 1.50
ENDIF

;ABL:従順をみる
IF ABL:従順 == 0
	TIMES LOCAL , 1.00
ELSEIF ABL:従順 == 1
	TIMES LOCAL , 0.80
ELSEIF ABL:従順 == 2
	TIMES LOCAL , 0.70
ELSEIF ABL:従順 == 3
	TIMES LOCAL , 0.50
ELSEIF ABL:従順 == 4
	TIMES LOCAL , 0.30
ELSE
	TIMES LOCAL , 0.10
ENDIF

;陥落していたら減らせる
SIF TALENT:恋慕 || TALENT:服従 || TALENT:淫乱
	TIMES LOCAL , 0.70

LOCAL:2 = LOCAL
;傷物
SIF TALENT:傷物
	TIMES LOCAL:2 , 0.40
SOURCE:反感追加 += LOCAL:2
UP:20 += LOCAL

;PALAM:反感 = LIMIT (PALAM:反感+LOCAL, 0, 99999999)

;-------------------------------------------------
;実行判定中の汚れ計算処理
;-------------------------------------------------
;ARG   = 見る汚れの部位
;ARG:1 = 1以上なら血および粘液の汚れも見る　でなければスルーする。
@COMORDER_STAIN_CALC(ARG, ARG:1)
#FUNCTION
RESULT = 0
;愛液の汚れ
SIF STAIN:PLAYER:ARG & 1
	RESULT += 1
;精液の汚れ
SIF STAIN:PLAYER:ARG & 4
	RESULT += 3
;アナルの汚れ
SIF STAIN:PLAYER:ARG & 8
	RESULT += 7
;母乳の汚れ
SIF STAIN:PLAYER:ARG & 16
	RESULT += 15
;血（破瓜)の汚れ
SIF ARG:1 >= 1 && STAIN:PLAYER:ARG & 32
	RESULT += 2
;粘液の汚れ
SIF ARG:1 >= 1 && STAIN:PLAYER:ARG & 64
	RESULT += 8
;血の汚れ
SIF ARG:1 >= 1 && STAIN:PLAYER:ARG & 128
	RESULT += 2

;汚臭鈍感
SIF TALENT:汚臭鈍感
	RESULT /= 3
;汚臭敏感
SIF TALENT:汚臭敏感
	RESULT *= 2

RETURNF RESULT
